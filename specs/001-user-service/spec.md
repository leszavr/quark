# –°–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è: User Service

**–í–µ—Ç–∫–∞**: `001-user-service`  
**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è**: 3 –Ω–æ—è–±—Ä—è 2025  
**–°—Ç–∞—Ç—É—Å**: –ß–µ—Ä–Ω–æ–≤–∏–∫  
**–í—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ**: "User Service - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, RBAC, VIP –ø–æ–¥–ø–∏—Å–∫–∏, –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏"

---

## üìã –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∏ —Å–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è

**–ö–∞–∫**: –ù–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å  
**–•–æ—á—É**: –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è –≤ —Å–∏—Å—Ç–µ–º–µ –∏ —Å–æ–∑–¥–∞—Ç—å —Å–≤–æ–π –ø—Ä–æ—Ñ–∏–ª—å  
**–ß—Ç–æ–±—ã**: –ù–∞—á–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –ø–ª–∞—Ç—Ñ–æ—Ä–º–æ–π Quark

#### Acceptance Criteria:
- [ ] –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è —Å email –∏ –ø–∞—Ä–æ–ª–µ–º
- [ ] –ü–æ—Å–ª–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞—ë—Ç—Å—è –ø—Ä–æ—Ñ–∏–ª—å —Å –±–∞–∑–æ–≤–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π
- [ ] –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–ª—É—á–∞–µ—Ç —Ä–æ–ª—å `user` –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
- [ ] Email –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ —Ç–æ–∫–µ–Ω (–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å notification-service)
- [ ] –ü—Ä–æ—Ñ–∏–ª—å —Å–æ–¥–µ—Ä–∂–∏—Ç: username, email, avatar (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ), bio (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

#### –¢–µ—Å—Ç–æ–≤—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏:

1. **Happy Path**:
   - –î–∞–Ω–æ: –ù–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç —Ñ–æ—Ä–º—É —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
   - –ö–æ–≥–¥–∞: –í–≤–æ–¥–∏—Ç –≤–∞–ª–∏–¥–Ω—ã–π email "user@example.com" –∏ –ø–∞—Ä–æ–ª—å "SecurePass123!"
   - –¢–æ–≥–¥–∞: 
     - –°–æ–∑–¥–∞—ë—Ç—Å—è —É—á—ë—Ç–Ω–∞—è –∑–∞–ø–∏—Å—å –≤ auth-service
     - –°–æ–∑–¥–∞—ë—Ç—Å—è –ø—Ä–æ—Ñ–∏–ª—å –≤ user-service
     - –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è email —Å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ–º
     - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è user_id –∏ JWT —Ç–æ–∫–µ–Ω

2. **Edge Cases**:
   - –î–∞–Ω–æ: Email —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –≤ —Å–∏—Å—Ç–µ–º–µ
   - –ö–æ–≥–¥–∞: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø—ã—Ç–∞–µ—Ç—Å—è –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è —Å —ç—Ç–∏–º email
   - –¢–æ–≥–¥–∞: –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –æ—à–∏–±–∫–∞ 409 Conflict —Å —Å–æ–æ–±—â–µ–Ω–∏–µ–º "Email already registered"

3. **Error Handling**:
   - –î–∞–Ω–æ: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–≤–æ–¥–∏—Ç –Ω–µ–≤–∞–ª–∏–¥–Ω—ã–π email "notanemail"
   - –ö–æ–≥–¥–∞: –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Ñ–æ—Ä–º—É —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
   - –¢–æ–≥–¥–∞: –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –æ—à–∏–±–∫–∞ 400 Bad Request —Å –¥–µ—Ç–∞–ª—è–º–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏

---

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª–µ–º

**–ö–∞–∫**: –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å  
**–•–æ—á—É**: –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é —Å–≤–æ–µ–≥–æ –ø—Ä–æ—Ñ–∏–ª—è  
**–ß—Ç–æ–±—ã**: –ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Å–≤–æ–π –∞–∫–∫–∞—É–Ω—Ç

#### Acceptance Criteria:
- [ ] –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –æ–±–Ω–æ–≤–∏—Ç—å username (—É–Ω–∏–∫–∞–ª—å–Ω—ã–π)
- [ ] –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –∑–∞–≥—Ä—É–∑–∏—Ç—å –∞–≤–∞—Ç–∞—Ä (–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å media-service)
- [ ] –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –∏–∑–º–µ–Ω–∏—Ç—å bio (–¥–æ 500 —Å–∏–º–≤–æ–ª–æ–≤)
- [ ] –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –æ–±–Ω–æ–≤–∏—Ç—å –∫–æ–Ω—Ç–∞–∫—Ç–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
- [ ] –ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π –ø—Ä–æ—Ñ–∏–ª—è –ª–æ–≥–∏—Ä—É–µ—Ç—Å—è –¥–ª—è –∞—É–¥–∏—Ç–∞

#### –¢–µ—Å—Ç–æ–≤—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏:

1. **Happy Path**:
   - –î–∞–Ω–æ: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω —Å JWT —Ç–æ–∫–µ–Ω–æ–º
   - –ö–æ–≥–¥–∞: –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç PATCH /api/v1/users/me —Å –Ω–æ–≤—ã–º username "cooluser"
   - –¢–æ–≥–¥–∞:
     - Username –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –≤ –ë–î
     - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –æ–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–π –ø—Ä–æ—Ñ–∏–ª—å
     - –ü—É–±–ª–∏–∫—É–µ—Ç—Å—è —Å–æ–±—ã—Ç–∏–µ `user.profile.updated` –≤ NATS

2. **Edge Cases**:
   - –î–∞–Ω–æ: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø—ã—Ç–∞–µ—Ç—Å—è —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å username, –∫–æ—Ç–æ—Ä—ã–π —É–∂–µ –∑–∞–Ω—è—Ç
   - –ö–æ–≥–¥–∞: –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç PATCH /api/v1/users/me {"username": "admin"}
   - –¢–æ–≥–¥–∞: –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è 409 Conflict "Username already taken"

---

### –°—Ü–µ–Ω–∞—Ä–∏–π 3: –°–∏—Å—Ç–µ–º–∞ —Ä–æ–ª–µ–π –∏ –ø—Ä–∞–≤ (RBAC)

**–ö–∞–∫**: –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä  
**–•–æ—á—É**: –£–ø—Ä–∞–≤–ª—è—Ç—å —Ä–æ–ª—è–º–∏ –∏ –ø—Ä–∞–≤–∞–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π  
**–ß—Ç–æ–±—ã**: –ö–æ–Ω—Ç—Ä–æ–ª–∏—Ä–æ–≤–∞—Ç—å –¥–æ—Å—Ç—É–ø –∫ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã

#### Acceptance Criteria:
- [ ] –°–∏—Å—Ç–µ–º–∞ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Ä–æ–ª–∏: `user`, `vip`, `moderator`, `admin`
- [ ] –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –º–æ–∂–µ—Ç –Ω–∞–∑–Ω–∞—á–∞—Ç—å/—Å–Ω–∏–º–∞—Ç—å —Ä–æ–ª–∏
- [ ] –ö–∞–∂–¥–∞—è —Ä–æ–ª—å –∏–º–µ–µ—Ç –Ω–∞–±–æ—Ä permissions (–Ω–∞–ø—Ä–∏–º–µ—Ä, `blog.publish`, `user.moderate`)
- [ ] JWT —Ç–æ–∫–µ–Ω —Å–æ–¥–µ—Ä–∂–∏—Ç –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ —Ä–æ–ª–∏ –∏ permissions
- [ ] –ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Ä–æ–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–æ–ª–∂–µ–Ω –ø–µ—Ä–µ–ª–æ–≥–∏–Ω–∏—Ç—å—Å—è

#### –¢–µ—Å—Ç–æ–≤—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏:

1. **Happy Path**:
   - –î–∞–Ω–æ: –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω
   - –ö–æ–≥–¥–∞: –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç POST /api/v1/users/{userId}/roles —Å role="vip"
   - –¢–æ–≥–¥–∞:
     - –†–æ–ª—å `vip` –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
     - –ü—É–±–ª–∏–∫—É–µ—Ç—Å—è —Å–æ–±—ã—Ç–∏–µ `user.role.granted` –≤ NATS
     - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –æ–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–π —Å–ø–∏—Å–æ–∫ —Ä–æ–ª–µ–π

2. **Permission Check**:
   - –î–∞–Ω–æ: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å —Ä–æ–ª—å—é `user` (–±–µ–∑ permission `blog.publish`)
   - –ö–æ–≥–¥–∞: –ü—ã—Ç–∞–µ—Ç—Å—è –æ–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å –ø–æ—Å—Ç —á–µ—Ä–µ–∑ blog-service
   - –¢–æ–≥–¥–∞: blog-service –ø—Ä–æ–≤–µ—Ä—è–µ—Ç JWT ‚Üí –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç 403 Forbidden

---

### –°—Ü–µ–Ω–∞—Ä–∏–π 4: VIP –ø–æ–¥–ø–∏—Å–∫–∏

**–ö–∞–∫**: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å  
**–•–æ—á—É**: –û—Ñ–æ—Ä–º–∏—Ç—å VIP –ø–æ–¥–ø–∏—Å–∫—É  
**–ß—Ç–æ–±—ã**: –ü–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ –ø—Ä–µ–º–∏—É–º —Ñ—É–Ω–∫—Ü–∏—è–º

#### Acceptance Criteria:
- [ ] –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –æ—Ñ–æ—Ä–º–∏—Ç—å –ø–æ–¥–ø–∏—Å–∫—É —Å —Ç–∏–ø–æ–º: `monthly`, `yearly`
- [ ] –°–∏—Å—Ç–µ–º–∞ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç —Å—Ç–∞—Ç—É—Å –ø–æ–¥–ø–∏—Å–∫–∏: `active`, `expired`, `cancelled`
- [ ] –ü—Ä–∏ –∞–∫—Ç–∏–≤–Ω–æ–π –ø–æ–¥–ø–∏—Å–∫–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–ª—É—á–∞–µ—Ç —Ä–æ–ª—å `vip`
- [ ] –ü—Ä–∏ –∏—Å—Ç–µ—á–µ–Ω–∏–∏ –ø–æ–¥–ø–∏—Å–∫–∏ —Ä–æ–ª—å `vip` –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–Ω–∏–º–∞–µ—Ç—Å—è
- [ ] –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å payment service (–ø–æ–∫–∞ –∑–∞–≥–ª—É—à–∫–∞)

#### –¢–µ—Å—Ç–æ–≤—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏:

1. **Happy Path**:
   - –î–∞–Ω–æ: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω
   - –ö–æ–≥–¥–∞: –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç POST /api/v1/subscriptions {"type": "monthly"}
   - –¢–æ–≥–¥–∞:
     - –°–æ–∑–¥–∞—ë—Ç—Å—è –∑–∞–ø–∏—Å—å Subscription —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º `active`
     - –†–æ–ª—å `vip` –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
     - –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è expiry_date = now + 30 –¥–Ω–µ–π
     - –ü—É–±–ª–∏–∫—É–µ—Ç—Å—è —Å–æ–±—ã—Ç–∏–µ `subscription.created`

2. **Expiration**:
   - –î–∞–Ω–æ: –ü–æ–¥–ø–∏—Å–∫–∞ —Å expiry_date –≤ –ø—Ä–æ—à–ª–æ–º
   - –ö–æ–≥–¥–∞: Cron job –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –∏—Å—Ç—ë–∫—à–∏–µ –ø–æ–¥–ø–∏—Å–∫–∏
   - –¢–æ–≥–¥–∞:
     - –°—Ç–∞—Ç—É—Å –º–µ–Ω—è–µ—Ç—Å—è –Ω–∞ `expired`
     - –†–æ–ª—å `vip` —Å–Ω–∏–º–∞–µ—Ç—Å—è
     - –ü—É–±–ª–∏–∫—É–µ—Ç—Å—è —Å–æ–±—ã—Ç–∏–µ `subscription.expired`

---

### –°—Ü–µ–Ω–∞—Ä–∏–π 5: –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–∏–≤–∞—Ç–Ω–æ—Å—Ç–∏

**–ö–∞–∫**: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å  
**–•–æ—á—É**: –£–ø—Ä–∞–≤–ª—è—Ç—å –ø—Ä–∏–≤–∞—Ç–Ω–æ—Å—Ç—å—é —Å–≤–æ–µ–≥–æ –ø—Ä–æ—Ñ–∏–ª—è  
**–ß—Ç–æ–±—ã**: –ö–æ–Ω—Ç—Ä–æ–ª–∏—Ä–æ–≤–∞—Ç—å, –∫—Ç–æ –≤–∏–¥–∏—Ç –º–æ—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é

#### Acceptance Criteria:
- [ ] –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤–∏–¥–∏–º–æ—Å—Ç—å –ø—Ä–æ—Ñ–∏–ª—è: `public`, `friends_only`, `private`
- [ ] –ù–∞—Å—Ç—Ä–æ–π–∫–∏ email: –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å/—Å–∫—Ä—ã–≤–∞—Ç—å –≤ –ø—Ä–æ—Ñ–∏–ª–µ
- [ ] –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –æ–Ω–ª–∞–π–Ω-—Å—Ç–∞—Ç—É—Å–∞: –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å/—Å–∫—Ä—ã–≤–∞—Ç—å
- [ ] –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π: email, push, in-app (–¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç–∏–ø–∞ —Å–æ–±—ã—Ç–∏–π)

#### –¢–µ—Å—Ç–æ–≤—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏:

1. **Happy Path**:
   - –î–∞–Ω–æ: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω
   - –ö–æ–≥–¥–∞: –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç PATCH /api/v1/users/me/settings {"profile_visibility": "private"}
   - –¢–æ–≥–¥–∞:
     - –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è –≤ –ë–î
     - –î—Ä—É–≥–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –Ω–µ –≤–∏–¥—è—Ç –ø—Ä–æ—Ñ–∏–ª—å –ø—Ä–∏ –ø–æ–∏—Å–∫–µ
     - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è —Å—Ç–∞—Ç—É—Å 200 OK

---

## üéØ –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

### –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

#### FR-1: –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
1. **[FR-1.1]**: –°–∏—Å—Ç–µ–º–∞ –î–û–õ–ñ–ù–ê —Å–æ–∑–¥–∞–≤–∞—Ç—å –ø—Ä–æ—Ñ–∏–ª—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
   - **–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç**: P0 (–∫—Ä–∏—Ç–∏—á–Ω–æ)
   - **–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏**: auth-service –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —É—á—ë—Ç–Ω–æ–π –∑–∞–ø–∏—Å–∏

2. **[FR-1.2]**: –°–∏—Å—Ç–µ–º–∞ –î–û–õ–ñ–ù–ê –ø–æ–∑–≤–æ–ª—è—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º –æ–±–Ω–æ–≤–ª—è—Ç—å —Å–≤–æ–π –ø—Ä–æ—Ñ–∏–ª—å
   - **–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç**: P0 (–∫—Ä–∏—Ç–∏—á–Ω–æ)
   - **–ü–æ–ª—è**: username, bio, avatar, contact_info

3. **[FR-1.3]**: –°–∏—Å—Ç–µ–º–∞ –î–û–õ–ñ–ù–ê –æ–±–µ—Å–ø–µ—á–∏–≤–∞—Ç—å —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å username
   - **–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç**: P0 (–∫—Ä–∏—Ç–∏—á–Ω–æ)

4. **[FR-1.4]**: –°–∏—Å—Ç–µ–º–∞ –î–û–õ–ñ–ù–ê –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å –∑–∞–≥—Ä—É–∑–∫—É –∞–≤–∞—Ç–∞—Ä–æ–≤ —á–µ—Ä–µ–∑ media-service
   - **–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç**: P1 (–≤–∞–∂–Ω–æ)
   - **–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏**: media-service

#### FR-2: –°–∏—Å—Ç–µ–º–∞ —Ä–æ–ª–µ–π –∏ –ø—Ä–∞–≤ (RBAC)
1. **[FR-2.1]**: –°–∏—Å—Ç–µ–º–∞ –î–û–õ–ñ–ù–ê –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å —Ä–æ–ª–∏: `user`, `vip`, `moderator`, `admin`
   - **–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç**: P0 (–∫—Ä–∏—Ç–∏—á–Ω–æ)

2. **[FR-2.2]**: –°–∏—Å—Ç–µ–º–∞ –î–û–õ–ñ–ù–ê –ø–æ–∑–≤–æ–ª—è—Ç—å –Ω–∞–∑–Ω–∞—á–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–æ–ª–µ–π –æ–¥–Ω–æ–º—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
   - **–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç**: P0 (–∫—Ä–∏—Ç–∏—á–Ω–æ)

3. **[FR-2.3]**: –ö–∞–∂–¥–∞—è —Ä–æ–ª—å –î–û–õ–ñ–ù–ê –∏–º–µ—Ç—å –Ω–∞–±–æ—Ä permissions
   - **–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç**: P0 (–∫—Ä–∏—Ç–∏—á–Ω–æ)
   - **–ü—Ä–∏–º–µ—Ä—ã**: `blog.read`, `blog.write`, `blog.publish`, `user.moderate`

4. **[FR-2.4]**: –°–∏—Å—Ç–µ–º–∞ –î–û–õ–ñ–ù–ê –≤–∫–ª—é—á–∞—Ç—å —Ä–æ–ª–∏ –∏ permissions –≤ JWT —Ç–æ–∫–µ–Ω
   - **–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç**: P0 (–∫—Ä–∏—Ç–∏—á–Ω–æ)
   - **–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏**: auth-service –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ JWT

#### FR-3: VIP –ø–æ–¥–ø–∏—Å–∫–∏
1. **[FR-3.1]**: –°–∏—Å—Ç–µ–º–∞ –î–û–õ–ñ–ù–ê –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å —Ç–∏–ø—ã –ø–æ–¥–ø–∏—Å–æ–∫: `monthly`, `yearly`
   - **–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç**: P1 (–≤–∞–∂–Ω–æ)

2. **[FR-3.2]**: –°–∏—Å—Ç–µ–º–∞ –î–û–õ–ñ–ù–ê –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–ø—Ä–∞–≤–ª—è—Ç—å —Ä–æ–ª—å—é `vip` –ø—Ä–∏ –∞–∫—Ç–∏–≤–Ω–æ–π –ø–æ–¥–ø–∏—Å–∫–µ
   - **–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç**: P1 (–≤–∞–∂–Ω–æ)

3. **[FR-3.3]**: –°–∏—Å—Ç–µ–º–∞ –î–û–õ–ñ–ù–ê –ø—Ä–æ–≤–µ—Ä—è—Ç—å –∏—Å—Ç–µ—á–µ–Ω–∏–µ –ø–æ–¥–ø–∏—Å–æ–∫ (cron job)
   - **–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç**: P1 (–≤–∞–∂–Ω–æ)

4. **[FR-3.4]**: –°–∏—Å—Ç–µ–º–∞ –î–û–õ–ñ–ù–ê –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ–± –∏—Å—Ç–µ—á–µ–Ω–∏–∏ –ø–æ–¥–ø–∏—Å–∫–∏
   - **–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç**: P2 (–∂–µ–ª–∞—Ç–µ–ª—å–Ω–æ)
   - **–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏**: notification-service

#### FR-4: –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
1. **[FR-4.1]**: –°–∏—Å—Ç–µ–º–∞ –î–û–õ–ñ–ù–ê –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–∏–≤–∞—Ç–Ω–æ—Å—Ç–∏ –ø—Ä–æ—Ñ–∏–ª—è
   - **–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç**: P1 (–≤–∞–∂–Ω–æ)
   - **–û–ø—Ü–∏–∏**: `public`, `friends_only`, `private`

2. **[FR-4.2]**: –°–∏—Å—Ç–µ–º–∞ –î–û–õ–ñ–ù–ê –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
   - **–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç**: P1 (–≤–∞–∂–Ω–æ)
   - **–ö–∞–Ω–∞–ª—ã**: email, push, in-app

3. **[FR-4.3]**: –°–∏—Å—Ç–µ–º–∞ –î–û–õ–ñ–ù–ê –ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø—Ä–æ—Ñ–∏–ª—è –¥–ª—è –∞—É–¥–∏—Ç–∞
   - **–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç**: P1 (–≤–∞–∂–Ω–æ)

### –ù–µ—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

#### NFR-1: –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- **[NFR-1.1]**: –°–∏—Å—Ç–µ–º–∞ –î–û–õ–ñ–ù–ê –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å 1000 –∑–∞–ø—Ä–æ—Å–æ–≤/—Å–µ–∫—É–Ω–¥—É –Ω–∞ —á—Ç–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è
- **[NFR-1.2]**: –í—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞ –î–û–õ–ñ–ù–û –±—ã—Ç—å < 200–º—Å –¥–ª—è 95% –∑–∞–ø—Ä–æ—Å–æ–≤
- **[NFR-1.3]**: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è –î–û–õ–ñ–ù–û –∑–∞–Ω–∏–º–∞—Ç—å < 500–º—Å

#### NFR-2: –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
- **[NFR-2.1]**: –°–∏—Å—Ç–µ–º–∞ –î–û–õ–ñ–ù–ê –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å JWT –∏–∑ Vault –¥–ª—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ (Article III)
- **[NFR-2.2]**: –ü–∞—Ä–æ–ª–∏ –î–û–õ–ñ–ù–´ —Ö—Ä–∞–Ω–∏—Ç—å—Å—è –≤ auth-service, –ù–ï –≤ user-service
- **[NFR-2.3]**: Sensitive –¥–∞–Ω–Ω—ã–µ (email, phone) –î–û–õ–ñ–ù–´ –±—ã—Ç—å –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω—ã –≤ –ë–î
- **[NFR-2.4]**: GDPR compliance: –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –∑–∞–ø—Ä–æ—Å–∏—Ç—å —É–¥–∞–ª–µ–Ω–∏–µ –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö

#### NFR-3: –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å
- **[NFR-3.1]**: –°–∏—Å—Ç–µ–º–∞ –î–û–õ–ñ–ù–ê –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ
- **[NFR-3.2]**: Stateless –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ (–≤—Å–µ –¥–∞–Ω–Ω—ã–µ –≤ PostgreSQL)
- **[NFR-3.3]**: Redis –∫—ç—à –¥–ª—è —á–∞—Å—Ç–æ –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ–º—ã—Ö –ø—Ä–æ—Ñ–∏–ª–µ–π (TTL 5 –º–∏–Ω—É—Ç)

#### NFR-4: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è (–ú–ö–° Architecture)
- **[NFR-4.1]**: –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ [Universal Docking Interface](../../docs/architecture/universal-docking-interface.md)
- **[NFR-4.2]**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –≤ Plugin Hub (Article II)
- **[NFR-4.3]**: –°–æ–±—ã—Ç–∏—è —á–µ—Ä–µ–∑ NATS JetStream (Article I):
  - `user.created`, `user.updated`, `user.deleted`
  - `user.role.granted`, `user.role.revoked`
  - `subscription.created`, `subscription.expired`
- **[NFR-4.4]**: –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ Article VII: ‚â§3 –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ (NestJS + PostgreSQL + Redis)

---

## ‚úÖ –ö—Ä–∏—Ç–µ—Ä–∏–∏ —É—Å–ø–µ—Ö–∞

### –ë–∏–∑–Ω–µ—Å-–º–µ—Ç—Ä–∏–∫–∏
- [ ] 95% –Ω–æ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞—é—Ç –ø—Ä–æ—Ñ–∏–ª—å
- [ ] –°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è —Å–æ–∑–¥–∞–Ω–∏—è –ø—Ä–æ—Ñ–∏–ª—è < 2 —Å–µ–∫—É–Ω–¥—ã
- [ ] 80% –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –æ–±–Ω–æ–≤–ª—è—é—Ç –ø—Ä–æ—Ñ–∏–ª—å –≤ —Ç–µ—á–µ–Ω–∏–µ –ø–µ—Ä–≤–æ–π –Ω–µ–¥–µ–ª–∏
- [ ] –ö–æ–Ω–≤–µ—Ä—Å–∏—è –≤ VIP –ø–æ–¥–ø–∏—Å–∫—É > 5% –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

### –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –º–µ—Ç—Ä–∏–∫–∏
- [ ] **Availability**: 99.9% uptime
- [ ] **Performance**: p95 latency < 200–º—Å –¥–ª—è —á—Ç–µ–Ω–∏—è, < 500–º—Å –¥–ª—è –∑–∞–ø–∏—Å–∏
- [ ] **Reliability**: Error rate < 0.1%
- [ ] **Constitution compliance**: –ü—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏–µ –≤—Å–µ—Ö Pre-Implementation Gates
- [ ] **Test Coverage**: ‚â•90% (contract + integration + e2e + unit tests)

### –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∞—è —Ü–µ–Ω–Ω–æ—Å—Ç—å
- [ ] –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –º–æ–≥—É—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é —É–ø—Ä–∞–≤–ª—è—Ç—å —Å–≤–æ–∏–º –ø—Ä–æ—Ñ–∏–ª–µ–º
- [ ] RBAC –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –≥–∏–±–∫–∏–π –∫–æ–Ω—Ç—Ä–æ–ª—å –¥–æ—Å—Ç—É–ø–∞
- [ ] VIP –ø–æ–¥–ø–∏—Å–∫–∞ –¥–∞—ë—Ç –æ—â—É—Ç–∏–º—ã–µ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞
- [ ] –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–∏–≤–∞—Ç–Ω–æ—Å—Ç–∏ –¥–∞—é—Ç –∫–æ–Ω—Ç—Ä–æ–ª—å –Ω–∞–¥ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏

---

## üîç –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –∏ –¥–æ–ø—É—â–µ–Ω–∏—è

### –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –æ–±–ª–∞—Å—Ç–∏ (Scope)

**–í scope**:
- –°–æ–∑–¥–∞–Ω–∏–µ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- –°–∏—Å—Ç–µ–º–∞ —Ä–æ–ª–µ–π –∏ –ø—Ä–∞–≤ (RBAC)
- VIP –ø–æ–¥–ø–∏—Å–∫–∏ (–±–µ–∑ –ø–ª–∞—Ç—ë–∂–Ω–æ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–∏–Ω–≥–∞)
- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –ø—Ä–∏–≤–∞—Ç–Ω–æ—Å—Ç–∏
- –°–æ–±—ã—Ç–∏—è –≤ NATS –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ —Å –¥—Ä—É–≥–∏–º–∏ —Å–µ—Ä–≤–∏—Å–∞–º–∏

**Out of scope**:
- –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è (—ç—Ç–æ auth-service)
- –ü–ª–∞—Ç—ë–∂–Ω—ã–π –ø—Ä–æ—Ü–µ—Å—Å–∏–Ω–≥ (–±—É–¥—É—â–∏–π payment-service)
- –°–æ—Ü–∏–∞–ª—å–Ω—ã–µ —Å–≤—è–∑–∏ –∏ —Ñ—Ä–µ–Ω–¥–ª–∏—Å—Ç (–±—É–¥—É—â–∏–π social-service)
- –°–∏—Å—Ç–µ–º–∞ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π –∏ –Ω–∞–≥—Ä–∞–¥ (–±—É–¥—É—â–∞—è —Ñ–∏—á–∞)

### –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–æ–ø—É—â–µ–Ω–∏—è
- **–ü—Ä–µ–¥–ø–æ–ª–æ–∂–µ–Ω–∏–µ 1**: auth-service —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç
- **–ü—Ä–µ–¥–ø–æ–ª–æ–∂–µ–Ω–∏–µ 2**: Plugin Hub –≥–æ—Ç–æ–≤ –∫ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –º–æ–¥—É–ª–µ–π
- **–ü—Ä–µ–¥–ø–æ–ª–æ–∂–µ–Ω–∏–µ 3**: NATS JetStream –Ω–∞—Å—Ç—Ä–æ–µ–Ω –∏ –¥–æ—Å—Ç—É–ø–µ–Ω
- **–ü—Ä–µ–¥–ø–æ–ª–æ–∂–µ–Ω–∏–µ 4**: HashiCorp Vault –Ω–∞—Å—Ç—Ä–æ–µ–Ω –¥–ª—è JWT —Å–µ–∫—Ä–µ—Ç–æ–≤

### –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –¥—Ä—É–≥–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
- **auth-service**: –°–æ–∑–¥–∞–Ω–∏–µ —É—á—ë—Ç–Ω—ã—Ö –∑–∞–ø–∏—Å–µ–π, –≥–µ–Ω–µ—Ä–∞—Ü–∏—è JWT
- **media-service**: –ó–∞–≥—Ä—É–∑–∫–∞ –∏ —Ö—Ä–∞–Ω–µ–Ω–∏–µ –∞–≤–∞—Ç–∞—Ä–æ–≤
- **notification-service**: Email —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è (–ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ, –∏—Å—Ç–µ—á–µ–Ω–∏–µ –ø–æ–¥–ø–∏—Å–∫–∏)
- **Plugin Hub**: –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –º–æ–¥—É–ª—è, service discovery

### –†–∏—Å–∫–∏
| –†–∏—Å–∫ | –í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å | –í–ª–∏—è–Ω–∏–µ | –ú–∏—Ç–∏–≥–∞—Ü–∏—è |
|------|------------|---------|-----------|
| –†–∞—Å—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Ä–æ–ª–µ–π –º–µ–∂–¥—É user-service –∏ JWT | –°—Ä–µ–¥–Ω—è—è | –ö—Ä–∏—Ç–∏—á–Ω–æ–µ | –û–±—è–∑–∞—Ç–µ–ª—å–Ω–∞—è –ø–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ —Å–æ–±—ã—Ç–∏—è —Ä–æ—Ç–∞—Ü–∏–∏ JWT –∏–∑ auth-service |
| –í—ã—Å–æ–∫–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ –ë–î –ø—Ä–∏ —á–∞—Å—Ç—ã—Ö –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è—Ö –ø—Ä–æ—Ñ–∏–ª–µ–π | –°—Ä–µ–¥–Ω—è—è | –ó–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ–µ | Redis –∫—ç—à + –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤ —Å –∏–Ω–¥–µ–∫—Å–∞–º–∏ |
| –ü—Ä–æ–±–ª–µ–º—ã —Å –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ–º –ø—Ä–∏ –º–∏–ª–ª–∏–æ–Ω–∞—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π | –ù–∏–∑–∫–∞—è | –ö—Ä–∏—Ç–∏—á–Ω–æ–µ | Stateless –¥–∏–∑–∞–π–Ω + sharding –ø–æ user_id (–±—É–¥—É—â–µ–µ) |
| GDPR compliance –ø—Ä–∏ —Ö—Ä–∞–Ω–µ–Ω–∏–∏ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö | –í—ã—Å–æ–∫–∞—è | –ö—Ä–∏—Ç–∏—á–Ω–æ–µ | –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ PII –¥–∞–Ω–Ω—ã—Ö + —Ñ—É–Ω–∫—Ü–∏—è –ø–æ–ª–Ω–æ–≥–æ —É–¥–∞–ª–µ–Ω–∏—è |

---

## üìä Data Requirements

> **–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ**: –î–µ—Ç–∞–ª—å–Ω–∞—è –º–æ–¥–µ–ª—å –±—É–¥–µ—Ç –≤ `data-model.md`

### –û—Å–Ω–æ–≤–Ω—ã–µ —Å—É—â–Ω–æ—Å—Ç–∏

1. **User (–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å)**:
   - –ê—Ç—Ä–∏–±—É—Ç—ã: id (UUID), username (unique), email (unique, encrypted), created_at, updated_at
   - Relationships: 
     - 1:1 ‚Üí Profile
     - 1:N ‚Üí UserRole
     - 1:N ‚Üí Subscription

2. **Profile (–ü—Ä–æ—Ñ–∏–ª—å)**:
   - –ê—Ç—Ä–∏–±—É—Ç—ã: user_id (FK), bio, avatar_url, contact_info (JSON), profile_visibility
   - Relationships: N:1 ‚Üí User

3. **Role (–†–æ–ª—å)**:
   - –ê—Ç—Ä–∏–±—É—Ç—ã: id, name (unique), description, permissions (JSON array)
   - Relationships: N:M ‚Üí User (—á–µ—Ä–µ–∑ UserRole)

4. **UserRole (–°–≤—è–∑—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å-—Ä–æ–ª—å)**:
   - –ê—Ç—Ä–∏–±—É—Ç—ã: user_id, role_id, granted_at, granted_by
   - Relationships: Junction table –¥–ª—è User ‚Üî Role

5. **Subscription (–ü–æ–¥–ø–∏—Å–∫–∞)**:
   - –ê—Ç—Ä–∏–±—É—Ç—ã: id, user_id, type (monthly/yearly), status, start_date, expiry_date
   - Relationships: N:1 ‚Üí User

6. **UserSettings (–ù–∞—Å—Ç—Ä–æ–π–∫–∏)**:
   - –ê—Ç—Ä–∏–±—É—Ç—ã: user_id (FK), settings (JSONB): notifications, privacy, preferences
   - Relationships: 1:1 ‚Üí User

### Data Retention
- **User**: –•—Ä–∞–Ω–∏—Ç—å –±–µ—Å—Å—Ä–æ—á–Ω–æ, —É–¥–∞–ª–µ–Ω–∏–µ —Ç–æ–ª—å–∫–æ –ø–æ –∑–∞–ø—Ä–æ—Å—É (GDPR)
- **Profile**: –•—Ä–∞–Ω–∏—Ç—å —Å User
- **Subscription**: –•—Ä–∞–Ω–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é –≤—Å–µ—Ö –ø–æ–¥–ø–∏—Å–æ–∫ (–¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏)
- **Audit logs**: –•—Ä–∞–Ω–∏—Ç—å 1 –≥–æ–¥, –∑–∞—Ç–µ–º –∞—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞—Ç—å

### Privacy & Security
- **PII (Personally Identifiable Information)**: email, phone, contact_info
- **–®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ**: AES-256 –¥–ª—è email –∏ phone –≤ –ë–î
- **GDPR compliance**: 
  - –ü—Ä–∞–≤–æ –Ω–∞ —É–¥–∞–ª–µ–Ω–∏–µ –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö (DELETE /api/v1/users/me)
  - –≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö –≤ JSON (GET /api/v1/users/me/export)
  - Audit trail –≤—Å–µ—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π

---

## üîó Integration Points

### –í—Ö–æ–¥—è—â–∏–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ (–ö—Ç–æ –≤—ã–∑—ã–≤–∞–µ—Ç user-service)
- **Frontend (Quark UI)**: REST API –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–æ—Ñ–∏–ª—è–º–∏
- **auth-service**: –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è –ø–æ—Å–ª–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
- **blog-service**: –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è—Ö –¥–ª—è –ø–æ—Å—Ç–æ–≤
- **messaging-service**: –ü–æ–ª—É—á–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª–µ–π –¥–ª—è –¥–∏–∞–ª–æ–≥–æ–≤

### –ò—Å—Ö–æ–¥—è—â–∏–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ (–ö–æ–≥–æ –≤—ã–∑—ã–≤–∞–µ—Ç user-service)
- **auth-service**: 
  - –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ä–æ–ª–µ–π –≤ JWT (—á–µ—Ä–µ–∑ Plugin Hub)
  - –í–∞–ª–∏–¥–∞—Ü–∏—è —Ç–æ–∫–µ–Ω–æ–≤ (—á–µ—Ä–µ–∑ Enterprise JWT Middleware)
- **media-service**: –ó–∞–≥—Ä—É–∑–∫–∞ –∏ –ø–æ–ª—É—á–µ–Ω–∏–µ URL –∞–≤–∞—Ç–∞—Ä–æ–≤
- **notification-service**: –û—Ç–ø—Ä–∞–≤–∫–∞ email —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

### –°–æ–±—ã—Ç–∏—è (NATS)

**–ü—É–±–ª–∏–∫—É–µ—Ç**:
- `user.created`: –ö–æ–≥–¥–∞ —Å–æ–∑–¥–∞—ë—Ç—Å—è –Ω–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å, –¥–∞–Ω–Ω—ã–µ: `{user_id, username, email}`
- `user.updated`: –ü—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –ø—Ä–æ—Ñ–∏–ª—è, –¥–∞–Ω–Ω—ã–µ: `{user_id, changes: {...}}`
- `user.deleted`: –ü—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –∞–∫–∫–∞—É–Ω—Ç–∞, –¥–∞–Ω–Ω—ã–µ: `{user_id, deleted_at}`
- `user.role.granted`: –ü—Ä–∏ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–∏ —Ä–æ–ª–∏, –¥–∞–Ω–Ω—ã–µ: `{user_id, role, granted_by}`
- `user.role.revoked`: –ü—Ä–∏ —Å–Ω—è—Ç–∏–∏ —Ä–æ–ª–∏, –¥–∞–Ω–Ω—ã–µ: `{user_id, role, revoked_by}`
- `subscription.created`: –ü—Ä–∏ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–∏ –ø–æ–¥–ø–∏—Å–∫–∏, –¥–∞–Ω–Ω—ã–µ: `{user_id, subscription_id, type, expiry_date}`
- `subscription.expired`: –ü—Ä–∏ –∏—Å—Ç–µ—á–µ–Ω–∏–∏ –ø–æ–¥–ø–∏—Å–∫–∏, –¥–∞–Ω–Ω—ã–µ: `{user_id, subscription_id}`

**–ü–æ–¥–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –Ω–∞**:
- `auth.user.registered`: –û—Ç auth-service –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –ø—Ä–æ—Ñ–∏–ª—è
  - –û–±—Ä–∞–±–æ—Ç—á–∏–∫: `handleUserRegistered()`
  - –î–µ–π—Å—Ç–≤–∏–µ: –°–æ–∑–¥–∞—Ç—å –∑–∞–ø–∏—Å—å User –∏ Profile –≤ –ë–î
- `auth.jwt.rotated`: –û—Ç auth-service –ø—Ä–∏ —Ä–æ—Ç–∞—Ü–∏–∏ JWT —Å–µ–∫—Ä–µ—Ç–æ–≤
  - –û–±—Ä–∞–±–æ—Ç—á–∏–∫: `handleJwtRotated()`
  - –î–µ–π—Å—Ç–≤–∏–µ: –û–±–Ω–æ–≤–∏—Ç—å –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –∫—ç—à –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ —Ç–æ–∫–µ–Ω–æ–≤

> **–ö–æ–Ω—Å—Ç–∏—Ç—É—Ü–∏—è**: –°–æ–±–ª—é–¥–µ–Ω–∏–µ Article I (Event-Driven Architecture) - –≤—Å–µ –º–µ–∂—Å–µ—Ä–≤–∏—Å–Ω—ã–µ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —á–µ—Ä–µ–∑ NATS

---

## üöÄ MVP Definition

### Must Have (–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –¥–ª—è –∑–∞–ø—É—Å–∫–∞)
- [ ] –°–æ–∑–¥–∞–Ω–∏–µ –∏ —á—Ç–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª–µ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- [ ] –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –±–∞–∑–æ–≤—ã—Ö –ø–æ–ª–µ–π –ø—Ä–æ—Ñ–∏–ª—è (username, bio)
- [ ] –°–∏—Å—Ç–µ–º–∞ —Ä–æ–ª–µ–π: `user`, `admin` (–º–∏–Ω–∏–º—É–º)
- [ ] –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ —Ä–æ–ª–µ–π –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º
- [ ] Universal Docking Interface —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω (module-manifest.yaml)
- [ ] Health checks —Ä–∞–±–æ—Ç–∞—é—Ç (`/health`, `/status`)
- [ ] –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –≤ Plugin Hub
- [ ] –°–æ–±—ã—Ç–∏—è –≤ NATS: `user.created`, `user.updated`, `user.role.granted`

### Should Have (–ñ–µ–ª–∞—Ç–µ–ª—å–Ω–æ, –Ω–æ –º–æ–∂–Ω–æ –æ—Ç–ª–æ–∂–∏—Ç—å)
- [ ] VIP –ø–æ–¥–ø–∏—Å–∫–∏ (–ø–æ–ª–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å)
- [ ] –ó–∞–≥—Ä—É–∑–∫–∞ –∞–≤–∞—Ç–∞—Ä–æ–≤ (–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å media-service)
- [ ] –î–µ—Ç–∞–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–∏–≤–∞—Ç–Ω–æ—Å—Ç–∏
- [ ] –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
- [ ] –†–æ–ª–∏ `vip` –∏ `moderator`

### Could Have (–î–ª—è –±—É–¥—É—â–∏—Ö –≤–µ—Ä—Å–∏–π)
- [ ] –≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è GDPR
- [ ] –ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π –ø—Ä–æ—Ñ–∏–ª—è (audit trail UI)
- [ ] –ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–µ permissions (fine-grained control)
- [ ] –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–Ω—è—Ç–∏–µ —Ä–æ–ª–∏ `vip` –ø—Ä–∏ –∏—Å—Ç–µ—á–µ–Ω–∏–∏ –ø–æ–¥–ø–∏—Å–∫–∏ (cron)

---

## üìù Review Checklist

### –ö–∞—á–µ—Å—Ç–≤–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
- [x] –û—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –¥–µ—Ç–∞–ª–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ (—è–∑—ã–∫–∏, —Ñ—Ä–µ–π–º–≤–æ—Ä–∫–∏, API)
- [x] –§–æ–∫—É—Å –Ω–∞ —Ü–µ–Ω–Ω–æ—Å—Ç–∏ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –±–∏–∑–Ω–µ—Å-–ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç—è—Ö
- [x] –ù–∞–ø–∏—Å–∞–Ω–æ –¥–ª—è –Ω–µ—Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏—Ö —Å—Ç–µ–π–∫—Ö–æ–ª–¥–µ—Ä–æ–≤
- [x] –í—Å–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ —Å–µ–∫—Ü–∏–∏ –∑–∞–ø–æ–ª–Ω–µ–Ω—ã

### –ü–æ–ª–Ω–æ—Ç–∞ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π
- [x] –ù–µ –æ—Å—Ç–∞–ª–æ—Å—å –º–∞—Ä–∫–µ—Ä–æ–≤ [–¢–†–ï–ë–£–ï–¢–°–Ø –£–¢–û–ß–ù–ï–ù–ò–ï]
- [x] –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è —Ç–µ—Å—Ç–∏—Ä—É–µ–º—ã –∏ –æ–¥–Ω–æ–∑–Ω–∞—á–Ω—ã
- [x] –ö—Ä–∏—Ç–µ—Ä–∏–∏ —É—Å–ø–µ—Ö–∞ –∏–∑–º–µ—Ä–∏–º—ã
- [x] –ö—Ä–∏—Ç–µ—Ä–∏–∏ —É—Å–ø–µ—Ö–∞ –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã –æ—Ç —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π
- [x] –í—Å–µ acceptance —Å—Ü–µ–Ω–∞—Ä–∏–∏ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã
- [x] Edge cases –∏–¥–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω—ã
- [x] –û–±–ª–∞—Å—Ç—å —á—ë—Ç–∫–æ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∞ (scope defined)
- [x] –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∏ –¥–æ–ø—É—â–µ–Ω–∏—è –∏–¥–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω—ã

### –ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—é
- [x] –í—Å–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –∏–º–µ—é—Ç —á—ë—Ç–∫–∏–µ acceptance criteria
- [x] –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ –ø–æ–∫—Ä—ã–≤–∞—é—Ç –æ—Å–Ω–æ–≤–Ω—ã–µ –ø–æ—Ç–æ–∫–∏
- [x] –°–µ—Ä–≤–∏—Å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –∏–∑–º–µ—Ä–∏–º—ã–º –∫—Ä–∏—Ç–µ—Ä–∏—è–º —É—Å–ø–µ—Ö–∞
- [ ] Constitution compliance –ø—Ä–æ–≤–µ—Ä–µ–Ω–∞ (–±—É–¥–µ—Ç –≤ plan.md)

### Stakeholder Review
- [ ] Product Owner —É—Ç–≤–µ—Ä–¥–∏–ª —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è
- [ ] Chief Architect –ø–æ–¥—Ç–≤–µ—Ä–¥–∏–ª —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ –ú–ö–°
- [ ] Security Team –ø—Ä–æ–≤–µ—Ä–∏–ª NFR-2 (–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å)

---

## üîÑ –í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏

**v1.0** (3 –Ω–æ—è–±—Ä—è 2025):
- –ù–∞—á–∞–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏
- –û–ø—Ä–µ–¥–µ–ª–µ–Ω—ã 5 –æ—Å–Ω–æ–≤–Ω—ã—Ö user stories
- 4 –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã—Ö —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π
- –î–µ—Ç–∞–ª—å–Ω—ã–µ acceptance criteria –∏ —Ç–µ—Å—Ç–æ–≤—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏

---

## üìö –°–≤—è–∑–∞–Ω–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã

- **Constitution**: `.specify/memory/constitution.md` - –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã
- **UDI Spec**: `docs/architecture/universal-docking-interface.md`
- **ADR-003**: `docs/adr/adr-003-module-docking.md` - –ú–æ–¥—É–ª—å–Ω–æ—Å—Ç—å –ø–æ –ø—Ä–∏–Ω—Ü–∏–ø—É –ú–ö–°
- **ADR-005**: `docs/adr/adr-005-jwt-auth.md` - JWT –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
- **Roadmap**: `docs/roadmap.md` - –û–±—â–∏–π –ø–ª–∞–Ω –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã (–≠—Ç–∞–ø 3)

---

**–ê–≤—Ç–æ—Ä**: AI Assistant + Product Owner  
**Reviewers**: [Product Owner], [Chief Architect], [Tech Lead]  
**–°–ª–µ–¥—É—é—â–∏–π —à–∞–≥**: –°–æ–∑–¥–∞–Ω–∏–µ `plan.md` –Ω–∞ –æ—Å–Ω–æ–≤–µ —ç—Ç–æ–π —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏
