# –°–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è: Auth UI Integration

**–í–µ—Ç–∫–∞**: `001-auth-ui-integration`  
**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è**: 2024-11-03  
**–°—Ç–∞—Ç—É—Å**: –ß–µ—Ä–Ω–æ–≤–∏–∫  
**–°–≤—è–∑–∞–Ω–Ω—ã–µ ADR**: [ADR-009: Unified Auth Entry Point](../../docs/adr/adr-009-unified-auth-entry-point.md)

## üìù –ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ

–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –µ–¥–∏–Ω–æ–π —Ç–æ—á–∫–∏ –≤—Ö–æ–¥–∞ –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏: `quark-landing/auth` –∫–∞–∫ —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è —Ñ–æ—Ä–º–∞ –≤—Ö–æ–¥–∞/—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –¥–ª—è –≤—Å–µ—Ö –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã (quark-ui). –†–µ–∞–ª–∏–∑–∞—Ü–∏—è OAuth2-like redirect flow —Å Auth Service backend –∏ Vault –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è JWT-—Å–µ–∫—Ä–µ—Ç–æ–≤.

---

## üìã –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ *(–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)*

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

**–ö–∞–∫**: –Ω–æ–≤—ã–π –ø–æ—Å–µ—Ç–∏—Ç–µ–ª—å –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã Quark  
**–•–æ—á—É**: –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è –≤ —Å–∏—Å—Ç–µ–º–µ —á–µ—Ä–µ–∑ —Ñ–æ—Ä–º—É –Ω–∞ –ª–µ–Ω–¥–∏–Ω–≥–µ  
**–ß—Ç–æ–±—ã**: –ø–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—É –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã

#### Acceptance Criteria (–ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–∏—ë–º–∫–∏):
- [ ] –§–æ—Ä–º–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –Ω–∞ quark-landing/auth –ø—Ä–∏–Ω–∏–º–∞–µ—Ç email, username, password
- [ ] –í–∞–ª–∏–¥–∞—Ü–∏—è email (—Ñ–æ—Ä–º–∞—Ç RFC 5322), –ø–∞—Ä–æ–ª—è (–º–∏–Ω–∏–º—É–º 8 —Å–∏–º–≤–æ–ª–æ–≤, 1 —Ü–∏—Ñ—Ä–∞, 1 —Å–ø–µ—Ü—Å–∏–º–≤–æ–ª)
- [ ] –ü—Ä–∏ —É—Å–ø–µ—à–Ω–æ–π —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ Auth Service –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç JWT —Ç–æ–∫–µ–Ω (—Å–µ–∫—Ä–µ—Ç –∏–∑ Vault)
- [ ] JWT —Ç–æ–∫–µ–Ω –ø–µ—Ä–µ–¥–∞—ë—Ç—Å—è –≤ quark-ui —á–µ—Ä–µ–∑ redirect_uri (query param –∏–ª–∏ httpOnly cookie)
- [ ] –ü–æ—Å–ª–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ —Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ —É–∫–∞–∑–∞–Ω–Ω—ã–π redirect_uri (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é /dashboard –≤ quark-ui)
- [ ] –ü—Ä–∏ –æ—à–∏–±–∫–µ (email –∑–∞–Ω—è—Ç) –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –ø–æ–Ω—è—Ç–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –±–µ–∑ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã

#### –¢–µ—Å—Ç–æ–≤—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏:
1. **Happy Path**:
   - –î–∞–Ω–æ: –ù–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –Ω–∞ quark-ui/dashboard –±–µ–∑ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
   - –ö–æ–≥–¥–∞: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ quark-landing/auth?redirect_uri=/dashboard
   - –ò: –ó–∞–ø–æ–ª–Ω—è–µ—Ç email, username, –ø–∞—Ä–æ–ª—å –∏ –Ω–∞–∂–∏–º–∞–µ—Ç "Register"
   - –¢–æ–≥–¥–∞: Auth Service —Å–æ–∑–¥–∞—ë—Ç –∞–∫–∫–∞—É–Ω—Ç, –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç JWT, —Ä–µ–¥–∏—Ä–µ–∫—Ç–∏—Ç –æ–±—Ä–∞—Ç–Ω–æ –Ω–∞ /dashboard
   - –ò: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç —Å–≤–æ–π dashboard —Å –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–º —Å–æ–æ–±—â–µ–Ω–∏–µ–º

2. **Edge Cases**:
   - –î–∞–Ω–æ: Email —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –≤ —Å–∏—Å—Ç–µ–º–µ
   - –ö–æ–≥–¥–∞: –ü—ã—Ç–∞–µ—Ç—Å—è –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è —Å —ç—Ç–∏–º email
   - –¢–æ–≥–¥–∞: –í–∏–¥–∏—Ç –æ—à–∏–±–∫—É "Email already registered" —Å –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ–º –≤–æ–π—Ç–∏

3. **Error Handling**:
   - –î–∞–Ω–æ: –ü–∞—Ä–æ–ª—å —Å–ª–∞–±—ã–π (–±–µ–∑ —Ü–∏—Ñ—Ä/—Å–ø–µ—Ü—Å–∏–º–≤–æ–ª–æ–≤)
   - –ö–æ–≥–¥–∞: –ü—ã—Ç–∞–µ—Ç—Å—è –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Ñ–æ—Ä–º—É
   - –¢–æ–≥–¥–∞: –í–∏–¥–∏—Ç –≤–∞–ª–∏–¥–∞—Ü–∏–æ–Ω–Ω—É—é –æ—à–∏–±–∫—É "Password must contain at least 1 digit and 1 special character"

---

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: –í—Ö–æ–¥ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

**–ö–∞–∫**: –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å  
**–•–æ—á—É**: –≤–æ–π—Ç–∏ –≤ —Å–∏—Å—Ç–µ–º—É —á–µ—Ä–µ–∑ —Ñ–æ—Ä–º—É  
**–ß—Ç–æ–±—ã**: –ø–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ —Å–≤–æ–µ–º—É –∞–∫–∫–∞—É–Ω—Ç—É

#### Acceptance Criteria:
- [ ] –§–æ—Ä–º–∞ –≤—Ö–æ–¥–∞ –Ω–∞ quark-landing/auth –ø—Ä–∏–Ω–∏–º–∞–µ—Ç email –∏ –ø–∞—Ä–æ–ª—å
- [ ] –ü—Ä–∏ —É—Å–ø–µ—à–Ω–æ–º –≤—Ö–æ–¥–µ Auth Service –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç JWT —Ç–æ–∫–µ–Ω (—Å–µ–∫—Ä–µ—Ç –∏–∑ Vault)
- [ ] JWT —Ç–æ–∫–µ–Ω –ø–µ—Ä–µ–¥–∞—ë—Ç—Å—è —á–µ—Ä–µ–∑ redirect_uri (query param –∏–ª–∏ httpOnly cookie)  
- [ ] –ü–æ—Å–ª–µ –≤—Ö–æ–¥–∞ —Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ –∏—Å—Ö–æ–¥–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É (–∏–∑ redirect_uri –ø–∞—Ä–∞–º–µ—Ç—Ä–∞)
- [ ] –ü—Ä–∏ –Ω–µ–≤–µ—Ä–Ω—ã—Ö credentials –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è —Å–æ–æ–±—â–µ–Ω–∏–µ "Invalid email or password"
- [ ] "Remember me" —á–µ–∫–±–æ–∫—Å —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç –≤—Ä–µ–º—è –∂–∏–∑–Ω–∏ —Ç–æ–∫–µ–Ω–∞ (7 –¥–Ω–µ–π –≤–º–µ—Å—Ç–æ 24 —á–∞—Å–æ–≤)

#### –¢–µ—Å—Ç–æ–≤—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏:
1. **Happy Path**:
   - –î–∞–Ω–æ: –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞ quark-landing/auth?redirect_uri=/messages
   - –ö–æ–≥–¥–∞: –í–≤–æ–¥–∏—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ email –∏ –ø–∞—Ä–æ–ª—å, –Ω–∞–∂–∏–º–∞–µ—Ç "Sign In"
   - –¢–æ–≥–¥–∞: Auth Service –≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç credentials, –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç JWT
   - –ò: –†–µ–¥–∏—Ä–µ–∫—Ç–∏—Ç –Ω–∞ /messages –≤ quark-ui —Å JWT —Ç–æ–∫–µ–Ω–æ–º
   - –ò: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç —Å–≤–æ–∏ —Å–æ–æ–±—â–µ–Ω–∏—è –±–µ–∑ –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏

2. **Edge Cases**:
   - –î–∞–Ω–æ: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –∏–ª–∏ –ø–∞—Ä–æ–ª—å –Ω–µ–≤–µ—Ä–Ω—ã–π
   - –ö–æ–≥–¥–∞: –ü—ã—Ç–∞–µ—Ç—Å—è –≤–æ–π—Ç–∏
   - –¢–æ–≥–¥–∞: –í–∏–¥–∏—Ç "Invalid email or password", —Ñ–æ—Ä–º–∞ –Ω–µ –æ—á–∏—â–∞–µ—Ç—Å—è

3. **Error Handling**:
   - –î–∞–Ω–æ: Auth Service –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω (500 error)
   - –ö–æ–≥–¥–∞: –ü—ã—Ç–∞–µ—Ç—Å—è –≤–æ–π—Ç–∏
   - –¢–æ–≥–¥–∞: –í–∏–¥–∏—Ç "Service temporarily unavailable. Please try again later."

---

### –°—Ü–µ–Ω–∞—Ä–∏–π 3: –í–∞–ª–∏–¥–∞—Ü–∏—è —Ç–æ–∫–µ–Ω–∞ –ø—Ä–∏ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏

**–ö–∞–∫**: –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å  
**–•–æ—á—É**: —á—Ç–æ–±—ã —Å–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–æ–≤–µ—Ä—è–ª–∞ –º–æ–π —Ç–æ–∫–µ–Ω  
**–ß—Ç–æ–±—ã**: –Ω–µ —Ç–µ—Ä—è—Ç—å –¥–æ—Å—Ç—É–ø –ø—Ä–∏ –Ω–µ–≤–∞–ª–∏–¥–Ω–æ–º —Ç–æ–∫–µ–Ω–µ –∏ –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤—ã–≤–∞—Ç—å—Å—è –ø–æ–≤—Ç–æ—Ä–Ω–æ –ø—Ä–∏ –≤–∞–ª–∏–¥–Ω–æ–º

#### Acceptance Criteria:
- [ ] –ü—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –∑–∞—â–∏—â—ë–Ω–Ω—ã—Ö —Å—Ç—Ä–∞–Ω–∏—Ü quark-ui –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è JWT –∏–∑ localStorage/cookie
- [ ] –ï—Å–ª–∏ —Ç–æ–∫–µ–Ω –≤–∞–ª–∏–¥–µ–Ω (–ø—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ /auth/validate) - –¥–æ—Å—Ç—É–ø —Ä–∞–∑—Ä–µ—à—ë–Ω
- [ ] –ï—Å–ª–∏ —Ç–æ–∫–µ–Ω –∏—Å—Ç—ë–∫ - —Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ quark-landing/auth?redirect_uri=<current_page>
- [ ] –ï—Å–ª–∏ —Ç–æ–∫–µ–Ω –Ω–µ–≤–∞–ª–∏–¥–µ–Ω - —Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ /auth –∏ –æ—á–∏—Å—Ç–∫–∞ localStorage/cookie
- [ ] Whitelist –¥–ª—è redirect_uri: localhost:3000, localhost:3101, *.quark-ai.ru

#### –¢–µ—Å—Ç–æ–≤—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏:
1. **Happy Path**:
   - –î–∞–Ω–æ: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å –≤–∞–ª–∏–¥–Ω—ã–º JWT –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –Ω–∞ /dashboard
   - –ö–æ–≥–¥–∞: –°—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è
   - –¢–æ–≥–¥–∞: JWT –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ /auth/validate, –¥–æ—Å—Ç—É–ø –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω

2. **Edge Cases**:
   - –î–∞–Ω–æ: JWT –∏—Å—Ç—ë–∫ (expired)
   - –ö–æ–≥–¥–∞: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø—ã—Ç–∞–µ—Ç—Å—è –æ—Ç–∫—Ä—ã—Ç—å /dashboard
   - –¢–æ–≥–¥–∞: –†–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ /login, —Å–æ–æ–±—â–µ–Ω–∏–µ "Session expired. Please log in again."

3. **Error Handling**:
   - –î–∞–Ω–æ: JWT –ø–æ–¥–¥–µ–ª–∞–Ω (invalid signature)
   - –ö–æ–≥–¥–∞: –ü—ã—Ç–∞–µ—Ç—Å—è –ø–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø
   - –¢–æ–≥–¥–∞: –†–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ /login, –æ—á–∏—Å—Ç–∫–∞ localStorage, —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ

---

## üéØ –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è *(–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)*

> **–ü—Ä–∏–Ω—Ü–∏–ø—ã**:
> - –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å **—Ç–µ—Å—Ç–∏—Ä—É–µ–º—ã–º–∏** –∏ **–æ–¥–Ω–æ–∑–Ω–∞—á–Ω—ã–º–∏**
> - –§–æ–∫—É—Å –Ω–∞ **—Ü–µ–Ω–Ω–æ—Å—Ç–∏ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è**, –∞ –Ω–µ –Ω–∞ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏—Ö –¥–µ—Ç–∞–ª—è—Ö
> - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å **[–¢–†–ï–ë–£–ï–¢–°–Ø –£–¢–û–ß–ù–ï–ù–ò–ï]** –¥–ª—è –Ω–µ–æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã—Ö –º–æ–º–µ–Ω—Ç–æ–≤

### –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

#### FR-1: –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
1. **[FR-1.1]**: –°–∏—Å—Ç–µ–º–∞ –î–û–õ–ñ–ù–ê –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è—Ç—å –µ–¥–∏–Ω—É—é —Ç–æ—á–∫—É –≤—Ö–æ–¥–∞ –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –Ω–∞ `quark-landing/auth`
   - **–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç**: P0 (–∫—Ä–∏—Ç–∏—á–Ω–æ)
   - **–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏**: Auth Service, Vault integration

2. **[FR-1.2]**: –°–∏—Å—Ç–µ–º–∞ –î–û–õ–ñ–ù–ê –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å redirect flow —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–º `redirect_uri`
   - **–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç**: P0 (–∫—Ä–∏—Ç–∏—á–Ω–æ)
   - **–í–∞–ª–∏–¥–∞—Ü–∏—è**: redirect_uri –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤ whitelist —Ä–∞–∑—Ä–µ—à—ë–Ω–Ω—ã—Ö –¥–æ–º–µ–Ω–æ–≤

3. **[FR-1.3]**: –°–∏—Å—Ç–µ–º–∞ –î–û–õ–ñ–ù–ê –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å —Ä–µ–∂–∏–º—ã login –∏ signup —á–µ—Ä–µ–∑ –æ–¥–∏–Ω –∫–æ–º–ø–æ–Ω–µ–Ω—Ç AuthForm
   - **–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç**: P0 (–∫—Ä–∏—Ç–∏—á–Ω–æ)

#### FR-2: JWT Token Management
1. **[FR-2.1]**: –°–∏—Å—Ç–µ–º–∞ –î–û–õ–ñ–ù–ê –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å JWT —Ç–æ–∫–µ–Ω—ã —Å —Å–µ–∫—Ä–µ—Ç–æ–º –∏–∑ Vault
   - **–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç**: P0 (–∫—Ä–∏—Ç–∏—á–Ω–æ)
   - **–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏**: FR-1.1, Vault (ADR-005)

2. **[FR-2.2]**: JWT –î–û–õ–ñ–ï–ù —Å–æ–¥–µ—Ä–∂–∞—Ç—å: user_id, email, username, roles, exp, iat
   - **–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç**: P0 (–∫—Ä–∏—Ç–∏—á–Ω–æ)

3. **[FR-2.3]**: –°–∏—Å—Ç–µ–º–∞ –î–û–õ–ñ–ù–ê –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å –¥–≤–∞ —Å—Ä–æ–∫–∞ –¥–µ–π—Å—Ç–≤–∏—è —Ç–æ–∫–µ–Ω–æ–≤:
   - –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é: 24 —á–∞—Å–∞
   - –° "Remember me": 7 –¥–Ω–µ–π
   - **–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç**: P1 (–≤–∞–∂–Ω–æ)

#### FR-3: API Endpoints
1. **[FR-3.1]**: POST /auth/register - —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
   - **–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç**: P0 (–∫—Ä–∏—Ç–∏—á–Ω–æ)
   - Input: {email, username, password}
   - Output: {token, user, expiresIn}

2. **[FR-3.2]**: POST /auth/login - –≤—Ö–æ–¥ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
   - **–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç**: P0 (–∫—Ä–∏—Ç–∏—á–Ω–æ)
   - Input: {email, password, rememberMe?}
   - Output: {token, user, expiresIn}

3. **[FR-3.3]**: GET /auth/validate - –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤–∞–ª–∏–¥–Ω–æ—Å—Ç–∏ —Ç–æ–∫–µ–Ω–∞
   - **–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç**: P0 (–∫—Ä–∏—Ç–∏—á–Ω–æ)
   - Header: Authorization: Bearer <token>
   - Output: {valid: boolean, user?: {...}}

4. **[FR-3.4]**: POST /auth/refresh - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏—Å—Ç—ë–∫—à–µ–≥–æ —Ç–æ–∫–µ–Ω–∞
   - **–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç**: P2 (–∂–µ–ª–∞—Ç–µ–ª—å–Ω–æ, –¥–ª—è v2)
   - Input: {refreshToken}
   - Output: {token, expiresIn}

### –ù–µ—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

#### NFR-1: –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- **[NFR-1.1]**: Redirect flow –î–û–õ–ñ–ï–ù –∑–∞–≤–µ—Ä—à–∞—Ç—å—Å—è –∑–∞ < 1 —Å–µ–∫—É–Ω–¥—É (p95)
- **[NFR-1.2]**: API /auth/login –∏ /auth/register –î–û–õ–ñ–ù–´ –æ—Ç–≤–µ—á–∞—Ç—å –∑–∞ < 300–º—Å (p95)
- **[NFR-1.3]**: API /auth/validate –î–û–õ–ñ–ï–ù –æ—Ç–≤–µ—á–∞—Ç—å –∑–∞ < 100–º—Å (p95, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –Ω–∞ –∫–∞–∂–¥–æ–º –∑–∞–ø—Ä–æ—Å–µ)

#### NFR-2: –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
- **[NFR-2.1]**: JWT —Ç–æ–∫–µ–Ω—ã –î–û–õ–ñ–ù–´ –ø–æ–¥–ø–∏—Å—ã–≤–∞—Ç—å—Å—è —Å–µ–∫—Ä–µ—Ç–æ–º –∏–∑ Vault (–Ω–µ hardcode)
- **[NFR-2.2]**: –ü–∞—Ä–æ–ª–∏ –î–û–õ–ñ–ù–´ —Ö–µ—à–∏—Ä–æ–≤–∞—Ç—å—Å—è —Å bcrypt (cost factor 12)
- **[NFR-2.3]**: redirect_uri –î–û–õ–ñ–ï–ù –≤–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å—Å—è –ø–æ whitelist (–∑–∞—â–∏—Ç–∞ –æ—Ç open redirect)
- **[NFR-2.4]**: Rate limiting –Ω–∞ /auth/login: –º–∞–∫—Å–∏–º—É–º 5 –ø–æ–ø—ã—Ç–æ–∫ –≤ –º–∏–Ω—É—Ç—É –Ω–∞ IP
- **[NFR-2.5]**: Rate limiting –Ω–∞ /auth/register: –º–∞–∫—Å–∏–º—É–º 3 —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –≤ —á–∞—Å –Ω–∞ IP
- **[NFR-2.6]**: HTTPS only –¥–ª—è production (HSTS –≤–∫–ª—é—á—ë–Ω)
- **[NFR-2.7]**: CSRF protection —á–µ—Ä–µ–∑ state parameter (–∫–∞–∫ –≤ OAuth2)
- **[NFR-2.8]**: –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ [Article III Constitution]: JWT —á–µ—Ä–µ–∑ Vault

#### NFR-3: –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å
- **[NFR-3.1]**: Auth Service –î–û–õ–ñ–ï–ù –±—ã—Ç—å stateless (–≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ)
- **[NFR-3.2]**: JWT –ø—Ä–æ–≤–µ—Ä–∫–∞ –ù–ï –î–û–õ–ñ–ù–ê —Ç—Ä–µ–±–æ–≤–∞—Ç—å –æ–±—Ä–∞—â–µ–Ω–∏—è –∫ –ë–î –Ω–∞ –∫–∞–∂–¥—ã–π –∑–∞–ø—Ä–æ—Å (signature validation –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ)
- **[NFR-3.3]**: –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –¥–æ 1000 –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–π –≤ —Å–µ–∫—É–Ω–¥—É

#### NFR-4: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è (–ú–ö–° Architecture)
- **[NFR-4.1]**: –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ [Universal Docking Interface](../../../docs/architecture/universal-docking-interface.md)
- **[NFR-4.2]**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è Auth Service –≤ Plugin Hub (Article II)
- **[NFR-4.3]**: –°–æ–±—ã—Ç–∏—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –î–û–õ–ñ–ù–´ –ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å—Å—è —á–µ—Ä–µ–∑ NATS:
  - `auth.user.registered` - –Ω–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
  - `auth.user.logged_in` - —É—Å–ø–µ—à–Ω—ã–π –≤—Ö–æ–¥
  - `auth.user.logged_out` - –≤—ã—Ö–æ–¥
- **[NFR-4.4]**: –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ [Article VII]: ‚â§3 –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ (auth-service, quark-landing/auth, quark-ui)

---

## ‚úÖ –ö—Ä–∏—Ç–µ—Ä–∏–∏ —É—Å–ø–µ—Ö–∞ *(–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)*

> –î–æ–ª–∂–Ω—ã –±—ã—Ç—å **–∏–∑–º–µ—Ä–∏–º—ã–º–∏** –∏ **–Ω–µ–∑–∞–≤–∏—Å–∏–º—ã–º–∏ –æ—Ç —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π**

### –ë–∏–∑–Ω–µ—Å-–º–µ—Ç—Ä–∏–∫–∏
- [ ] **Conversion rate**: ‚â•85% –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∑–∞–≤–µ—Ä—à–∞—é—Ç —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é –ø–æ—Å–ª–µ –Ω–∞—á–∞–ª–∞ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è —Ñ–æ—Ä–º—ã
- [ ] **Time to auth**: –°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è –æ—Ç –∫–ª–∏–∫–∞ "Register" –¥–æ –ø–æ–∫–∞–∑–∞ dashboard < 3 —Å–µ–∫—É–Ω–¥—ã (–≤–∫–ª—é—á–∞—è redirect)
- [ ] **Error rate**: < 1% –æ—à–∏–±–æ–∫ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –∏–∑-–∑–∞ –ø—Ä–æ–±–ª–µ–º —Å–∏—Å—Ç–µ–º—ã (–Ω–µ credentials)
- [ ] **User satisfaction**: NPS ‚â• 7/10 –¥–ª—è –ø—Ä–æ—Ü–µ—Å—Å–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ (–æ–ø—Ä–æ—Å –ø–æ—Å–ª–µ –ø–µ—Ä–≤–æ–≥–æ –≤—Ö–æ–¥–∞)

### –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –º–µ—Ç—Ä–∏–∫–∏
- [ ] **Availability**: 99.9% uptime –¥–ª—è Auth Service –∑–∞ –º–µ—Å—è—Ü
- [ ] **Performance**: p95 latency < 300–º—Å –¥–ª—è /auth/login
- [ ] **Performance**: p95 latency < 100–º—Å –¥–ª—è /auth/validate
- [ ] **Reliability**: Error rate < 0.1% –¥–ª—è –≤—Å–µ—Ö auth endpoints
- [ ] **Security**: 0 –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö —É—è–∑–≤–∏–º–æ—Å—Ç–µ–π –≤ OWASP Top 10
- [ ] **Constitution compliance**: –ü—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏–µ –≤—Å–µ—Ö Pre-Implementation Gates (—Å–º. Constitution)

### –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∞—è —Ü–µ–Ω–Ω–æ—Å—Ç—å
- [ ] **–ï–¥–∏–Ω—ã–π –æ–ø—ã—Ç**: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–≤—Ç–æ—Ä–∏–∑—É–µ—Ç—Å—è –æ–¥–∏–Ω —Ä–∞–∑ –∏ –ø–æ–ª—É—á–∞–µ—Ç –¥–æ—Å—Ç—É–ø –∫–æ –≤—Å–µ–º —á–∞—Å—Ç—è–º –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã (–±–ª–æ–≥, –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä, –∞–¥–º–∏–Ω–∫–∞)
- [ ] **Seamless redirect**: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É, —Å –∫–æ—Ç–æ—Ä–æ–π –Ω–∞—á–∞–ª –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é (–Ω–µ —Ç–µ—Ä—è–µ—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç)
- [ ] **Clear errors**: –ü—Ä–∏ –æ—à–∏–±–∫–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç –ø–æ–Ω—è—Ç–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ (–Ω–µ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π stack trace)

---

## üîç –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –∏ –¥–æ–ø—É—â–µ–Ω–∏—è

### –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –æ–±–ª–∞—Å—Ç–∏ (Scope)
**–í scope**:
- ‚úÖ –ï–¥–∏–Ω–∞—è —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞ –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –Ω–∞ `quark-landing/auth`
- ‚úÖ Redirect flow —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π `redirect_uri` –ø–∞—Ä–∞–º–µ—Ç—Ä–∞
- ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è Auth Service —Å Vault –¥–ª—è JWT-—Å–µ–∫—Ä–µ—Ç–æ–≤
- ‚úÖ API endpoints: /auth/register, /auth/login, /auth/validate
- ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è quark-ui (–ø—Ä–æ–≤–µ—Ä–∫–∞ —Ç–æ–∫–µ–Ω–∞, —Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ /auth –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏)
- ‚úÖ –ë–∞–∑–æ–≤–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è email/password (—Ñ–æ—Ä–º–∞—Ç, –¥–ª–∏–Ω–∞, —Å–ª–æ–∂–Ω–æ—Å—Ç—å)
- ‚úÖ NATS —Å–æ–±—ã—Ç–∏—è –¥–ª—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏/–≤—Ö–æ–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- ‚úÖ Rate limiting –¥–ª—è –∑–∞—â–∏—Ç—ã –æ—Ç brute-force

**Out of scope** (–¥–ª—è –±—É–¥—É—â–∏—Ö –≤–µ—Ä—Å–∏–π):
- ‚ùå Social OAuth (Google, GitHub, GitLab) - –æ—Ç–ª–æ–∂–µ–Ω–æ –≤ spec 002
- ‚ùå Refresh tokens (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ) - –æ—Ç–ª–æ–∂–µ–Ω–æ –≤ v2
- ‚ùå Password reset —á–µ—Ä–µ–∑ email - –æ—Ç–ª–æ–∂–µ–Ω–æ –≤ spec 003
- ‚ùå Two-Factor Authentication (2FA/TOTP) - –æ—Ç–ª–æ–∂–µ–Ω–æ –≤ spec 004
- ‚ùå Magic links (passwordless auth) - –æ—Ç–ª–æ–∂–µ–Ω–æ –≤ v3
- ‚ùå Standalone auth-ui –º–∏–∫—Ä–æ—Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ - –±—É–¥–µ—Ç –ø—Ä–∏ –ø–æ—è–≤–ª–µ–Ω–∏–∏ desktop/mobile –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä–∞
- ‚ùå Session management UI (—Å–ø–∏—Å–æ–∫ –∞–∫—Ç–∏–≤–Ω—ã—Ö —Å–µ—Å—Å–∏–π) - –æ—Ç–ª–æ–∂–µ–Ω–æ –≤ v2

### –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–æ–ø—É—â–µ–Ω–∏—è
- **–î–æ–ø—É—â–µ–Ω–∏–µ 1**: –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∞—è PostgreSQL –ë–î –∏–∑ auth-service –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- **–î–æ–ø—É—â–µ–Ω–∏–µ 2**: Vault —É–∂–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω –∏ –¥–æ—Å—Ç—É–ø–µ–Ω –¥–ª—è auth-service (–∏–∑ –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö —Å–ø—Ä–∏–Ω—Ç–æ–≤)
- **–î–æ–ø—É—â–µ–Ω–∏–µ 3**: quark-landing –∏ quark-ui —Ä–∞–±–æ—Ç–∞—é—Ç –Ω–∞ —Ä–∞–∑–Ω—ã—Ö –ø–æ—Ä—Ç–∞—Ö/–¥–æ–º–µ–Ω–∞—Ö (—Ç—Ä–µ–±—É–µ—Ç—Å—è CORS)
- **–î–æ–ø—É—â–µ–Ω–∏–µ 4**: JWT —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ localStorage –Ω–∞ —Å—Ç–æ—Ä–æ–Ω–µ –∫–ª–∏–µ–Ω—Ç–∞ (httpOnly cookies - –≤ –±—É–¥—É—â–µ–º –ø–æ—Å–ª–µ security audit)
- **–î–æ–ø—É—â–µ–Ω–∏–µ 5**: Email –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ (verification) –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è –¥–ª—è MVP (–¥–æ–±–∞–≤–∏—Ç—Å—è –≤ spec 003)

### –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –¥—Ä—É–≥–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
- **Auth Service**: Backend API –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ (—É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç, —Ç—Ä–µ–±—É–µ—Ç—Å—è –¥–æ—Ä–∞–±–æ—Ç–∫–∞ –¥–ª—è redirect_uri)
- **Vault**: –•—Ä–∞–Ω–∏–ª–∏—â–µ JWT_SECRET –∏ –¥—Ä—É–≥–∏—Ö —Å–µ–∫—Ä–µ—Ç–æ–≤ (—É–∂–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω)
- **NATS**: –ü—É–±–ª–∏–∫–∞—Ü–∏—è —Å–æ–±—ã—Ç–∏–π `auth.user.*` –¥–ª—è –¥—Ä—É–≥–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
- **PostgreSQL**: –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (—É–∂–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è auth-service)
- **Plugin Hub**: –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è auth-service –¥–ª—è service discovery (Constitution Article II)

### –†–∏—Å–∫–∏
| –†–∏—Å–∫ | –í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å | –í–ª–∏—è–Ω–∏–µ | –ú–∏—Ç–∏–≥–∞—Ü–∏—è |
|------|------------|---------|-----------|
| –ù–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å quark-landing –±–ª–æ–∫–∏—Ä—É–µ—Ç –≤—Å—é –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é | –ù–∏–∑–∫–∞—è | –ö—Ä–∏—Ç–∏—á–Ω–æ–µ | High availability –¥–ª—è landing (CDN, multiple replicas), –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ uptime |
| CSRF –∞—Ç–∞–∫–∏ —á–µ—Ä–µ–∑ –º–∞–Ω–∏–ø—É–ª—è—Ü–∏—é redirect_uri | –°—Ä–µ–¥–Ω—è—è | –ó–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ–µ | Whitelist –¥–æ–º–µ–Ω–æ–≤, state/nonce –ø–∞—Ä–∞–º–µ—Ç—Ä—ã, –ø—Ä–æ–≤–µ—Ä–∫–∞ referer |
| XSS –∫—Ä–∞–∂–∞ JWT –∏–∑ localStorage | –°—Ä–µ–¥–Ω—è—è | –ö—Ä–∏—Ç–∏—á–Ω–æ–µ | Content-Security-Policy, –ø–µ—Ä–µ—Ö–æ–¥ –Ω–∞ httpOnly cookies –ø–æ—Å–ª–µ MVP |
| Brute-force –∞—Ç–∞–∫–∏ –Ω–∞ /auth/login | –í—ã—Å–æ–∫–∞—è | –ó–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ–µ | Rate limiting (5 –ø–æ–ø—ã—Ç–æ–∫/–º–∏–Ω—É—Ç—É), CAPTCHA –ø–æ—Å–ª–µ 3 –Ω–µ—É–¥–∞—á (v2) |
| Vault –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ auth-service | –ù–∏–∑–∫–∞—è | –ö—Ä–∏—Ç–∏—á–Ω–æ–µ | Retry logic, health checks, alert –≤ Prometheus |

---

## üìä Data Requirements (–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ –¥–∞–Ω–Ω—ã–º)

> **–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ**: –≠—Ç–æ –≤—ã—Å–æ–∫–æ—É—Ä–æ–≤–Ω–µ–≤–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ, –¥–µ—Ç–∞–ª—å–Ω–∞—è –º–æ–¥–µ–ª—å –±—É–¥–µ—Ç –≤ `data-model.md`

### –û—Å–Ω–æ–≤–Ω—ã–µ —Å—É—â–Ω–æ—Å—Ç–∏
1. **User** (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å):
   - –ê—Ç—Ä–∏–±—É—Ç—ã: id (UUID), email (unique), username (unique), password_hash, created_at, updated_at, is_active, roles
   - Relationships: –æ–¥–∏–Ω –∫–æ –º–Ω–æ–≥–∏–º —Å Session (–¥–ª—è –±—É–¥—É—â–µ–≥–æ session management)
   - Storage: PostgreSQL (—Ç–∞–±–ª–∏—Ü–∞ users –≤ auth-service –ë–î)

2. **JWT Token** (–≤—Ä–µ–º–µ–Ω–Ω–∞—è —Å—É—â–Ω–æ—Å—Ç—å, –Ω–µ —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ –ë–î):
   - –ê—Ç—Ä–∏–±—É—Ç—ã: sub (user_id), email, username, roles, iat (issued at), exp (expires at)
   - Storage: –ö–ª–∏–µ–Ω—Ç (localStorage/cookie), –≤–∞–ª–∏–¥–∞—Ü–∏—è —á–µ—Ä–µ–∑ –ø–æ–¥–ø–∏—Å—å

### Data Retention (–•—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö)
- **User accounts**: –•—Ä–∞–Ω–∏—Ç—å –±–µ—Å—Å—Ä–æ—á–Ω–æ (–ø–æ–∫–∞ –∞–∫—Ç–∏–≤–Ω—ã), –∞—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞—Ç—å —á–µ—Ä–µ–∑ 2 –≥–æ–¥–∞ –Ω–µ–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
- **JWT tokens**: –ù–µ —Ö—Ä–∞–Ω—è—Ç—Å—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ (stateless), –∏—Å—Ç–µ–∫–∞—é—Ç —á–µ—Ä–µ–∑ 24—á –∏–ª–∏ 7 –¥–Ω–µ–π
- **Audit logs** (–±—É–¥—É—â–µ–µ): –õ–æ–≥–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–π —Ö—Ä–∞–Ω–∏—Ç—å 90 –¥–Ω–µ–π –¥–ª—è —Ä–∞—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–π

### Privacy & Security
- **PII (Personally Identifiable Information)**: email, username
- **Sensitive data**: password (—Ö—Ä–∞–Ω–∏—Ç—Å—è –∫–∞–∫ bcrypt hash, cost 12)
- **–®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ**: JWT_SECRET —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ Vault –≤ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω–æ–º –≤–∏–¥–µ
- **GDPR compliance**: 
  - –ü—Ä–∞–≤–æ –Ω–∞ —É–¥–∞–ª–µ–Ω–∏–µ: –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –∑–∞–ø—Ä–æ—Å–∏—Ç—å —É–¥–∞–ª–µ–Ω–∏–µ –∞–∫–∫–∞—É–Ω—Ç–∞ (–±—É–¥—É—â–µ–µ API)
  - –ü—Ä–∞–≤–æ –Ω–∞ —ç–∫—Å–ø–æ—Ä—Ç: –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç —Å–∫–∞—á–∞—Ç—å —Å–≤–æ–∏ –¥–∞–Ω–Ω—ã–µ (–±—É–¥—É—â–µ–µ)
  - –ú–∏–Ω–∏–º–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö: —Å–æ–±–∏—Ä–∞–µ–º —Ç–æ–ª—å–∫–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø–æ–ª—è (email, username, password)

---

## üîó Integration Points (–¢–æ—á–∫–∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏)

### –í—Ö–æ–¥—è—â–∏–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ (–ö—Ç–æ –≤—ã–∑—ã–≤–∞–µ—Ç Auth Service)
- **quark-landing/auth** (frontend): –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Ñ–æ—Ä–º—ã —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏/–≤—Ö–æ–¥–∞ —á–µ—Ä–µ–∑ REST API
- **quark-ui** (frontend): –ü—Ä–æ–≤–µ—Ä—è–µ—Ç JWT —Ç–æ–∫–µ–Ω —á–µ—Ä–µ–∑ GET /auth/validate –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –∑–∞—â–∏—â—ë–Ω–Ω—ã—Ö —Å—Ç—Ä–∞–Ω–∏—Ü
- **–ë—É–¥—É—â–∏–µ —Å–µ—Ä–≤–∏—Å—ã** (blog-api, messaging-api): –ë—É–¥—É—Ç –≤–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å JWT —á–µ—Ä–µ–∑ middleware (–Ω–µ –Ω–∞–ø—Ä—è–º—É—é)

### –ò—Å—Ö–æ–¥—è—â–∏–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ (–ö–æ–≥–æ –≤—ã–∑—ã–≤–∞–µ—Ç Auth Service)
- **Vault**: –ü–æ–ª—É—á–µ–Ω–∏–µ JWT_SECRET –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ —Å–µ—Ä–≤–∏—Å–∞ (AppRole auth)
- **PostgreSQL**: –•—Ä–∞–Ω–µ–Ω–∏–µ –∏ –ø—Ä–æ–≤–µ—Ä–∫–∞ —É—á—ë—Ç–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- **NATS JetStream**: –ü—É–±–ª–∏–∫–∞—Ü–∏—è —Å–æ–±—ã—Ç–∏–π –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏

### –°–æ–±—ã—Ç–∏—è (NATS)
**–ü—É–±–ª–∏–∫—É–µ—Ç**:
- `auth.user.registered`: –ö–æ–≥–¥–∞ –Ω–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–≤–µ—Ä—à–∞–µ—Ç —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é
  ```json
  {
    "user_id": "uuid",
    "email": "user@example.com",
    "username": "johndoe",
    "timestamp": "2024-11-03T12:00:00Z"
  }
  ```
- `auth.user.logged_in`: –ö–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É—Å–ø–µ—à–Ω–æ –∞–≤—Ç–æ—Ä–∏–∑—É–µ—Ç—Å—è
  ```json
  {
    "user_id": "uuid",
    "email": "user@example.com",
    "ip_address": "192.168.1.1",
    "user_agent": "Mozilla/5.0...",
    "timestamp": "2024-11-03T12:00:00Z"
  }
  ```
- `auth.user.logged_out`: –ö–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã—Ö–æ–¥–∏—Ç (–±—É–¥—É—â–µ–µ)
  ```json
  {
    "user_id": "uuid",
    "timestamp": "2024-11-03T14:00:00Z"
  }
  ```

**–ü–æ–¥–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –Ω–∞**:
- –ü–æ–∫–∞ –Ω–µ—Ç –ø–æ–¥–ø–∏—Å–æ–∫ (Auth Service - source of truth –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏)

> **–ö–æ–Ω—Å—Ç–∏—Ç—É—Ü–∏—è**: –°–æ–±–ª—é–¥–µ–Ω–∏–µ Article I (Event-Driven Architecture) - –≤—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è –ø—É–±–ª–∏–∫—É—é—Ç—Å—è –∫–∞–∫ —Å–æ–±—ã—Ç–∏—è

---

## üöÄ MVP Definition (–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–≥–æ –ø—Ä–æ–¥—É–∫—Ç–∞)

### Must Have (–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –¥–ª—è –∑–∞–ø—É—Å–∫–∞)
- [ ] **Auth Service API endpoints**: /auth/register, /auth/login, /auth/validate
- [ ] **Vault integration**: JWT_SECRET —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ Vault, –Ω–µ –≤ –∫–æ–¥–µ
- [ ] **quark-landing/auth**: –ï–¥–∏–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ —Å AuthForm (login/signup —Ä–µ–∂–∏–º—ã)
- [ ] **Redirect flow**: –ü–æ–¥–¥–µ—Ä–∂–∫–∞ redirect_uri —Å whitelist –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π
- [ ] **quark-ui integration**: –ü—Ä–æ–≤–µ—Ä–∫–∞ JWT, —Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ /auth –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏
- [ ] **Password security**: bcrypt hashing (cost 12), –≤–∞–ª–∏–¥–∞—Ü–∏—è —Å–ª–æ–∂–Ω–æ—Å—Ç–∏
- [ ] **Rate limiting**: –ó–∞—â–∏—Ç–∞ –æ—Ç brute-force –Ω–∞ /auth/login –∏ /auth/register
- [ ] **NATS events**: –ü—É–±–ª–∏–∫–∞—Ü–∏—è auth.user.registered –∏ auth.user.logged_in
- [ ] **Health checks**: /health endpoint –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
- [ ] **Plugin Hub registration**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è auth-service

### Should Have (–ñ–µ–ª–∞—Ç–µ–ª—å–Ω–æ, –Ω–æ –º–æ–∂–Ω–æ –æ—Ç–ª–æ–∂–∏—Ç—å)
- [ ] **Remember me**: –£–≤–µ–ª–∏—á–µ–Ω–∏–µ —Å—Ä–æ–∫–∞ —Ç–æ–∫–µ–Ω–∞ –¥–æ 7 –¥–Ω–µ–π
- [ ] **Error logging**: Structured logs –¥–ª—è –≤—Å–µ—Ö –æ—à–∏–±–æ–∫ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
- [ ] **Metrics**: Prometheus –º–µ—Ç—Ä–∏–∫–∏ (login_attempts, registration_count, etc.)
- [ ] **CAPTCHA**: –ü–æ—Å–ª–µ 3 –Ω–µ—É–¥–∞—á–Ω—ã—Ö –ø–æ–ø—ã—Ç–æ–∫ –≤—Ö–æ–¥–∞ (–∑–∞—â–∏—Ç–∞ –æ—Ç –±–æ—Ç–æ–≤)

### Could Have (–î–ª—è –±—É–¥—É—â–∏—Ö –≤–µ—Ä—Å–∏–π)
- [ ] **Social OAuth**: Google, GitHub, GitLab (spec 002)
- [ ] **Password reset**: –ß–µ—Ä–µ–∑ email —Å —Ç–æ–∫–µ–Ω–æ–º (spec 003)
- [ ] **2FA/TOTP**: Two-factor authentication (spec 004)
- [ ] **Refresh tokens**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤ (v2)
- [ ] **Session management UI**: –°–ø–∏—Å–æ–∫ –∞–∫—Ç–∏–≤–Ω—ã—Ö —Å–µ—Å—Å–∏–π, logout –Ω–∞ –≤—Å–µ—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö (v2)
- [ ] **Email verification**: –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ email –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ (spec 003)
- [ ] **Magic links**: Passwordless auth —á–µ—Ä–µ–∑ email (v3)

---

## üìù Review Checklist (–ß–µ–∫-–ª–∏—Å—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏)

> –ó–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è –ø–µ—Ä–µ–¥ –ø–µ—Ä–µ—Ö–æ–¥–æ–º –∫ —ç—Ç–∞–ø—É –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è

### –ö–∞—á–µ—Å—Ç–≤–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
- [ ] –û—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –¥–µ—Ç–∞–ª–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ (—è–∑—ã–∫–∏, —Ñ—Ä–µ–π–º–≤–æ—Ä–∫–∏, API)
- [ ] –§–æ–∫—É—Å –Ω–∞ —Ü–µ–Ω–Ω–æ—Å—Ç–∏ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –±–∏–∑–Ω–µ—Å-–ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç—è—Ö
- [ ] –ù–∞–ø–∏—Å–∞–Ω–æ –¥–ª—è –Ω–µ—Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏—Ö —Å—Ç–µ–π–∫—Ö–æ–ª–¥–µ—Ä–æ–≤
- [ ] –í—Å–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ —Å–µ–∫—Ü–∏–∏ –∑–∞–ø–æ–ª–Ω–µ–Ω—ã

### –ü–æ–ª–Ω–æ—Ç–∞ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π
- [ ] –ù–µ –æ—Å—Ç–∞–ª–æ—Å—å –º–∞—Ä–∫–µ—Ä–æ–≤ [–¢–†–ï–ë–£–ï–¢–°–Ø –£–¢–û–ß–ù–ï–ù–ò–ï]
- [ ] –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è —Ç–µ—Å—Ç–∏—Ä—É–µ–º—ã –∏ –æ–¥–Ω–æ–∑–Ω–∞—á–Ω—ã
- [ ] –ö—Ä–∏—Ç–µ—Ä–∏–∏ —É—Å–ø–µ—Ö–∞ –∏–∑–º–µ—Ä–∏–º—ã
- [ ] –ö—Ä–∏—Ç–µ—Ä–∏–∏ —É—Å–ø–µ—Ö–∞ –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã –æ—Ç —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π (–±–µ–∑ –¥–µ—Ç–∞–ª–µ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏)
- [ ] –í—Å–µ acceptance —Å—Ü–µ–Ω–∞—Ä–∏–∏ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã
- [ ] Edge cases –∏–¥–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω—ã
- [ ] –û–±–ª–∞—Å—Ç—å —á—ë—Ç–∫–æ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∞ (scope defined)
- [ ] –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∏ –¥–æ–ø—É—â–µ–Ω–∏—è –∏–¥–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω—ã

### –ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—é
- [ ] –í—Å–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –∏–º–µ—é—Ç —á—ë—Ç–∫–∏–µ acceptance criteria
- [ ] –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ –ø–æ–∫—Ä—ã–≤–∞—é—Ç –æ—Å–Ω–æ–≤–Ω—ã–µ –ø–æ—Ç–æ–∫–∏
- [ ] –°–µ—Ä–≤–∏—Å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –∏–∑–º–µ—Ä–∏–º—ã–º –∫—Ä–∏—Ç–µ—Ä–∏—è–º —É—Å–ø–µ—Ö–∞
- [ ] Constitution compliance –ø—Ä–æ–≤–µ—Ä–µ–Ω–∞ (Articles I, II, III, VII)

### Stakeholder Review
- [ ] Product Owner —É—Ç–≤–µ—Ä–¥–∏–ª —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è
- [ ] Chief Architect –ø–æ–¥—Ç–≤–µ—Ä–¥–∏–ª —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ –ú–ö–°
- [ ] Security Team –ø—Ä–æ–≤–µ—Ä–∏–ª NFR-2 (–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å)

---

## üîÑ –í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏

**v1.0** ([–¥–∞—Ç–∞]):
- –ù–∞—á–∞–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏

**v1.1** ([–¥–∞—Ç–∞]):
- [–û–ø–∏—Å–∞–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π]

---

## üìö –°–≤—è–∑–∞–Ω–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã

- **Constitution**: `.specify/memory/constitution.md` - –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã
- **UDI Spec**: `docs/architecture/universal-docking-interface.md`
- **ADR**: `docs/adr/` - –†–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è
- **Roadmap**: `docs/roadmap.md` - –û–±—â–∏–π –ø–ª–∞–Ω –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã

---

**–ê–≤—Ç–æ—Ä**: [–ò–º—è/–ö–æ–º–∞–Ω–¥–∞]  
**Reviewers**: [Product Owner], [Chief Architect], [Tech Lead]  
**–°–ª–µ–¥—É—é—â–∏–π —à–∞–≥**: –°–æ–∑–¥–∞–Ω–∏–µ `plan.md` —á–µ—Ä–µ–∑ `/speckit.plan`
