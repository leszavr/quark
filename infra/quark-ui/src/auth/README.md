# Аутентификация в Quark UI

## Обзор

В этом документе описано, как реализовать аутентификацию через Plugin Hub и Auth Service.

## Архитектура аутентификации

### Текущая реализация
- Моковые данные пользователя
- Нет реальной аутентификации

### Новая реализация
- Интеграция с Auth Service через Plugin Hub
- Использование JWT токенов
- Хранение состояния аутентификации в appStore

## Поток аутентификации

### Регистрация
1. Пользователь заполняет форму регистрации
2. Запрос отправляется на `/api/auth/register` (через Traefik → Plugin Hub → Auth Service)
3. При успешной регистрации пользователь перенаправляется на страницу логина

### Вход
1. Пользователь заполняет форму входа
2. Запрос отправляется на `/api/auth/login`
3. При успешной аутентификации:
   - Auth Service устанавливает JWT токен в cookies
   - Пользователь перенаправляется в основное приложение
   - Состояние аутентификации обновляется в appStore

### Выход
1. Пользователь нажимает кнопку выхода
2. Запрос отправляется на `/api/auth/logout`
3. Auth Service очищает JWT токен из cookies
4. Состояние аутентификации сбрасывается в appStore
5. Пользователь перенаправляется на страницу логина

### Проверка аутентификации
1. При загрузке приложения проверяется наличие валидного JWT токена
2. Если токен валиден, пользователь считается аутентифицированным
3. Если токен отсутствует или недействителен, пользователь перенаправляется на страницу логина

## Интеграция с API

### Защищенные эндпоинты
Все API вызовы к защищенным эндпоинтам автоматически включают JWT токен через cookies.

### Middleware
Traefik ForwardAuth middleware проверяет JWT токен и добавляет заголовки с пользовательскими данными:
- `X-User-Id`
- `X-User-Roles`
- `X-User-Permissions`

## Хранение состояния

### Zustand Store
Состояние аутентификации хранится в `appStore`:
- `isAuthenticated` - флаг аутентификации
- `user` - данные пользователя (если нужно)

### Cookies
JWT токен хранится в httpOnly cookies для безопасности.

## Обработка ошибок

### Ошибки аутентификации
- Неверные учетные данные (401)
- Пользователь не найден (404)
- Аккаунт заблокирован (403)

### Ошибки регистрации
- Пользователь уже существует (409)
- Некорректные данные (400)
- Проблемы с валидацией (422)

## Безопасность

### Защита токенов
- Использование httpOnly cookies
- Secure флаг для HTTPS
- SameSite для защиты от CSRF

### Валидация данных
- Валидация на клиенте
- Валидация на сервере
- Санитизация входных данных