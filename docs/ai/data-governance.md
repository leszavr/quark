# Управление данными ИИ

## Версия
1.0

## Статус
Утверждён

## Цель
Обеспечить **этичное, безопасное и прозрачное использование данных** в ИИ-агентах Quark, с соблюдением прав пользователей и требований регуляторов (GDPR, ФЗ-152).

---

## 1. Принципы

| Принцип | Описание |
|--------|--------|
| **Сбор только с согласия** | Пользователь явно даёт согласие на использование его данных для обучения ИИ |
| **Минимизация данных** | ИИ получает только необходимые данные (например, текст поста, а не весь профиль) |
| **Владение данными** | Пользователь остаётся владельцем своих данных |
| **Прозрачность** | Пользователь знает, когда и зачем используется ИИ |
| **Шифрование** | Данные ИИ шифруются при хранении и передаче |

---

## 2. Типы данных ИИ

| Данные | Использование | Хранение | Шифрование |
|-------|--------------|---------|-----------|
| **Контекст диалога** | Генерация ответов в мессенджере | Redis (временно) | Да (TLS + at rest) |
| **Текст постов** | Обучение персонализированного ИИ | PostgreSQL (согласие) | Да |
| **Промпты пользователя** | Оптимизация генерации | PostgreSQL | Да |
| **Реакции на ИИ-контент** | Обучение модели | PostgreSQL | Да |
| **Метаданные** | Аналитика (без PII) | PostgreSQL | Нет |

> 🔐 **PII (персональные данные)** никогда не передаются в LLM напрямую.

---

## 3. Политики хранения

| Данные | Срок хранения | Действие после истечения |
|-------|----------------|--------------------------|
| Контекст диалога | 1 час | Автоматическое удаление |
| Текст постов (для обучения) | 5 лет (с согласия) | Архивация |
| Промпты | 2 года | Архивация |
| Реакции | 3 года | Архивация |
| Логи использования ИИ | 30 дней | Удаление |

> 📅 Сроки могут быть изменены пользователем через настройки.

---

## 4. Аудит использования данных

### 4.1. Что аудируется
- Какой ИИ-агент использовал данные
- Какие данные были переданы
- Когда и зачем
- Результат (сгенерированный контент)

### 4.2. Где хранится аудит
```json
{
  "audit_id": "audit-123",
  "user_id": "user-456",
  "ai_agent": "ai-writer",
  "data_used": ["post_id", "prompt"],
  "timestamp": "2025-04-05T10:00:00Z",
  "purpose": "content_generation",
  "response_hash": "sha256:abc123..."
}
```
→ Хранится в `audit-log` (PostgreSQL)

### 4.3. Доступ к аудиту
- **Пользователь**: может запросить отчёт
- **Администратор**: полный доступ
- **ИИ**: только для self-audit (через `ai-ops-agent`)

---

## 5. Процедура отзыва согласия

Пользователь может:
- Отозвать согласие на использование данных для обучения ИИ
- Удалить свои данные из ИИ-систем

### Процесс:
1. Пользователь нажимает "Отозвать согласие" в настройках
2. Система:
   - Помечает данные как "на удаление"
   - Удаляет контекст из Redis
   - Помечает посты как "не для обучения"
   - Удаляет из векторной базы (если используется)
3. Через 7 дней — физическое удаление
4. Пользователь получает подтверждение

> ✅ Соответствует **GDPR (право на забвение)** и **ФЗ-152**

---

## 6. Шифрование данных ИИ

| Уровень | Технология | Описание |
|--------|-----------|---------|
| **In Transit** | TLS 1.3 | Все вызовы к `ai-orchestrator`, `ai-writer` |
| **At Rest (Redis)** | AES-256 | Контекст диалогов шифруется перед сохранением |
| **At Rest (PostgreSQL)** | TDE (Transparent Data Encryption) | Для данных обучения |
| **Контекст в памяти** | Обнуление после использования | После генерации — очистка |

---

## 7. Ответственные
| Роль | Ответственность |
|------|-----------------|
| **Пользователь** | Даёт/отзывает согласие |
| **AI Ops Agent** | Мониторинг использования данных |
| **Администратор** | Управление политиками |
| **DevOps** | Настройка шифрования |