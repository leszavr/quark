# Incident Response Playbook

## Версия
1.0

## Статус
Утверждён

## Цель
Обеспечить быструю, согласованную реакцию на инциденты безопасности и сбои в работе системы.

## 1. Роли и ответственность (связано с `raci.md`)

| Роль | Ответственный | Действия |
|------|---------------|---------|
| **Incident Commander** | Человек (или Qwen при его недоступности) | Координация, принятие решений |
| **Communicator** | Qwen | Уведомления в Slack/Telegram, отчётность |
| **Technician** | DevOps / SRE | Восстановление, анализ, исправление |
| **Auditor** | Человек | Проверка действий, post-mortem |

## 2. Процесс реагирования

### Этап 1: Обнаружение
- Алерт из **Grafana** (latency, error rate)
- Уведомление в **Slack/Telegram**
- Автоматическая фиксация времени инцидента

### Этап 2: Классификация
| Уровень | Примеры | Реакция |
|--------|--------|--------|
| **Критический** | Падение `auth-service`, утечка данных | Немедленное вмешательство |
| **Высокий** | Ошибки в `blog-service`, DDoS | В течение 15 мин |
| **Средний** | Медленная работа ИИ | В течение 1 часа |

### Этап 3: Изоляция
- Масштабирование сервиса до 0: `kubectl scale deployment/blog-service --replicas=0`
- Блокировка IP (если DDoS): `iptables` / Cloudflare
- Отключение модуля: `plugin-hub disable seo-analyzer`

### Этап 4: Анализ
- Просмотр логов: `kubectl logs blog-pod-123`
- Анализ трейсов: Grafana Tempo
- Проверка событий: NATS consumer
- Поиск root cause

### Этап 5: Исправление
- Откат: `kubectl rollout undo deployment/blog-service`
- Патч: CI/CD → новый образ
- Восстановление из бэкапа (если нужно)

### Этап 6: Post-mortem
- Заполнение шаблона:
  ```markdown
  ## Что произошло?
  ## Причина?
  ## Как обнаружено?
  ## Как исправлено?
  ## Как предотвратить?
  ```
- Публикация в `#incidents` канале
- Обновление `threat-model-report.md`, `slo.md`

## 3. Типовые сценарии

### 3.1. Утечка данных
- Отозвать токены
- Провести аудит доступа
- Уведомить пользователей

### 3.2. DDoS-атака
- Включить Cloudflare WAF
- Rate limiting
- Блокировка IP-диапазонов

### 3.3. Сбой ИИ-агента
- Отключить модуль
- Переключить на резервный агент
- Провести анализ контекста

## 4. Инструменты
- **Grafana** — мониторинг
- **Sentry** — ошибки
- **k9s / kubectl** — управление K8s
- **Slack / Telegram** — коммуникация
- **Notion / Confluence** — post-mortem