# ADR-011: Система миграций баз данных

## Статус

Принято

## Контекст

В проекте Quark инициализация баз данных происходила через raw SQL скрипты (init-databases.sql). Это создавало следующие проблемы:

1. Отсутствие контроля версий схемы БД
2. Сложность воспроизведения состояния БД
3. Проблемы с развертыванием в разных окружениях
4. Невозможность отката изменений

## Решение

1. Внедрить систему миграций для всех сервисов:
   - auth-service: Использовать TypeORM миграции
   - blog-service: Использовать Drizzle ORM миграции
2. Удалить init-databases.sql и заменить его на систему миграций
3. Добавить скрипты для автоматического применения миграций при запуске сервисов

## Реализация

### auth-service (TypeORM)

- Создана папка src/migrations
- Добавлены скрипты миграций в package.json
- Создана конфигурация DataSource для миграций
- Создана первая миграция InitAuthTables

### blog-service (Drizzle ORM)

- Создана папка migrations
- Добавлены скрипты миграций в package.json
- Создана первая миграция на основе схемы

## Последствия

### Положительные

- Контроль версий схемы БД
- Возможность воспроизведения состояния БД
- Простота развертывания в разных окружениях
- Возможность отката изменений

### Отрицательные

- Необходимость поддержки миграций при изменении схемы БД
- Дополнительная сложность при разработке

## См. также

- [CRITICAL-CONFIG.md](file:///home/odmen/quark/docs/CRITICAL-CONFIG.md) - критические конфигурации проекта
- Документация TypeORM Migrations
- Документация Drizzle ORM Migrations