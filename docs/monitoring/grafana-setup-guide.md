# üöÄ –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ Grafana

## ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### 1. **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω –∫–æ–Ω—Ñ–ª–∏–∫—Ç –ø–æ—Ä—Ç–æ–≤**
- OpenTelemetry Collector —Ç–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ø–æ—Ä—Ç `4319:4317` (gRPC) –∏ `4318:4318` (HTTP)
- Tempo –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ç–æ–ª—å–∫–æ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –ø–æ—Ä—Ç `4317` –≤ Docker-—Å–µ—Ç–∏

### 2. **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å–±–æ—Ä–∞ –º–µ—Ç—Ä–∏–∫**
- Prometheus —Ç–µ–ø–µ—Ä—å —Å–æ–±–∏—Ä–∞–µ—Ç –º–µ—Ç—Ä–∏–∫–∏ —Å `auth-service:9464/metrics`
- OpenTelemetry Collector –Ω–∞—Å—Ç—Ä–æ–µ–Ω –Ω–∞ —Å–±–æ—Ä –º–µ—Ç—Ä–∏–∫ –∏–∑ auth-service

### 3. **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –¥–∞—à–±–æ—Ä–¥—ã**
- –û–±–Ω–æ–≤–ª–µ–Ω `quark-overview.json` –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –º–µ—Ç—Ä–∏–∫
- –°–æ–∑–¥–∞–Ω –Ω–æ–≤—ã–π –¥–∞—à–±–æ—Ä–¥ `auth-service-detailed.json` —Å –¥–µ—Ç–∞–ª—å–Ω—ã–º–∏ –º–µ—Ç—Ä–∏–∫–∞–º–∏

### 4. **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω auth-service**
- –£–±—Ä–∞–Ω–æ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –º–µ—Ç—Ä–∏–∫
- –ò—Å–ø—Ä–∞–≤–ª–µ–Ω OTLP endpoint –Ω–∞ `http://otel-collector:4318`

### 5. **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ DNS-—Ä–µ–∑–æ–ª—é—Ü–∏—è –≤ Docker**
- –î–æ–±–∞–≤–ª–µ–Ω—ã —è–≤–Ω—ã–µ –∏–º–µ–Ω–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ (`container_name`)
- –í—Å–µ —Å–µ—Ä–≤–∏—Å—ã –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤ –æ–¥–Ω–æ–π —Å–µ—Ç–∏ `quark-network`

## üß™ –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é

### –®–∞–≥ 1: –ü–æ–ª–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ –∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫
```bash
# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã –∏ —É–¥–∞–ª–∏—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
docker-compose -f infra/monitoring/docker-compose.monitoring.yml down --remove-orphans
docker-compose -f services/auth-service/docker-compose.yml down --remove-orphans

# –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ —Å–µ—Ç—å —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
docker network create quark-network 2>/dev/null || true

# –ó–∞–ø—É—Å—Ç–∏—Ç—å –∑–∞–Ω–æ–≤–æ
./start-quark.sh
```

### –®–∞–≥ 2: –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Ä—Ç–æ–≤
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –Ω–µ—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ –ø–æ—Ä—Ç–æ–≤
docker ps | grep -E "(otel|tempo)"

# –î–æ–ª–∂–Ω–æ –±—ã—Ç—å:
# otel-collector ... 0.0.0.0:4318->4318/tcp, 0.0.0.0:4319->4317/tcp
# tempo          ... 0.0.0.0:3200->3200/tcp
```

### –®–∞–≥ 3: –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–µ—Ç—Ä–∏–∫ auth-service
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ auth-service —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç –º–µ—Ç—Ä–∏–∫–∏
curl http://localhost:9464/metrics

# –î–æ–ª–∂–Ω—ã –±—ã—Ç—å –º–µ—Ç—Ä–∏–∫–∏:
# http_requests_total{method="GET",route="/health",status="200"} 1
# http_request_duration_seconds_bucket{...} 0.001
```

### –®–∞–≥ 4: –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö
```bash
# –°–¥–µ–ª–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –∑–∞–ø—Ä–æ—Å–æ–≤ –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –º–µ—Ç—Ä–∏–∫
curl http://localhost:3001/health
curl http://localhost:3001/health
curl http://localhost:3001/health

# –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –ª–æ–≥–∏–Ω (–±—É–¥–µ—Ç –æ—à–∏–±–∫–∞, –Ω–æ –º–µ—Ç—Ä–∏–∫–∏ –ø–æ—è–≤—è—Ç—Å—è)
curl -X POST http://localhost:3001/auth/login \
  -H "Content-Type: application/x-www-form-urlencoded" \
  -d "username=test&password=test"

# –ì–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–µ –æ—à–∏–±–∫–∏
curl http://localhost:3001/test/error
curl http://localhost:3001/test/client-error
```

### –®–∞–≥ 5: –ü—Ä–æ–≤–µ—Ä–∫–∞ Grafana
1. –û—Ç–∫—Ä–æ–π—Ç–µ http://localhost:3000
2. –í–æ–π–¥–∏—Ç–µ: `admin` / `quark`
3. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **Dashboards ‚Üí Manage**
4. –î–æ–ª–∂–Ω—ã –±—ã—Ç—å –¥–æ—Å—Ç—É–ø–Ω—ã:
   - `Quark System Overview`
   - `Auth Service - Detailed Metrics`

### –®–∞–≥ 6: –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞–Ω–Ω—ã—Ö –≤ –¥–∞—à–±–æ—Ä–¥–∞—Ö

#### –í –¥–∞—à–±–æ—Ä–¥–µ "Quark System Overview":
- **System Metrics Overview**: –¥–æ–ª–∂–Ω—ã –ø–æ—è–≤–∏—Ç—å—Å—è –¥–∞–Ω–Ω—ã–µ –æ HTTP –∑–∞–ø—Ä–æ—Å–∞—Ö
- **System Latency**: –¥–æ–ª–∂–Ω–∞ –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è –ª–∞—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å p95/p99
- **Error Rates**: –¥–æ–ª–∂–Ω—ã –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å—Å—è –æ—à–∏–±–∫–∏ 4xx/5xx
- **Recent System Logs**: –¥–æ–ª–∂–Ω—ã –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è –ª–æ–≥–∏ auth-service

#### –í –¥–∞—à–±–æ—Ä–¥–µ "Auth Service - Detailed Metrics":
- **Login Requests Rate**: –∑–∞–ø—Ä–æ—Å—ã –∫ `/auth/login` –∏ `/auth/validate`
- **Authentication Latency**: –ª–∞—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
- **Authentication Errors**: –æ—à–∏–±–∫–∏ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
- **HTTP Status Codes Distribution**: —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å-–∫–æ–¥–æ–≤
- **All Endpoints Activity**: –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –≤—Å–µ—Ö —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤

## üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º

### –ï—Å–ª–∏ –º–µ—Ç—Ä–∏–∫–∏ –Ω–µ –ø–æ—è–≤–ª—è—é—Ç—Å—è:

1. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ OpenTelemetry Collector:**
```bash
docker logs monitoring_otel-collector_1
# –ò—Å–∫–∞—Ç—å: "MetricsExporter", "TracesExporter"
```

2. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ auth-service:**
```bash
docker logs auth-service_auth-service_1
# –ò—Å–∫–∞—Ç—å: "Metrics initialized successfully"
```

3. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å Prometheus targets:**
- –û—Ç–∫—Ä–æ–π—Ç–µ http://localhost:9090/targets
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ `auth-service` target –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–∏ UP

4. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å Grafana Data Sources:**
- –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ Configuration ‚Üí Data Sources
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Prometheus, Tempo, Loki

## üìä –î–æ—Å—Ç—É–ø–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏

| –ú–µ—Ç—Ä–∏–∫–∞ | –û–ø–∏—Å–∞–Ω–∏–µ | –ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞ |
|---------|----------|----------------|
| `http_requests_total` | –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ HTTP –∑–∞–ø—Ä–æ—Å–æ–≤ | `sum(rate(http_requests_total[5m]))` |
| `http_request_duration_seconds` | –ì–∏—Å—Ç–æ–≥—Ä–∞–º–º–∞ –≤—Ä–µ–º–µ–Ω–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è | `histogram_quantile(0.95, rate(http_request_duration_seconds_bucket[5m]))` |
| `http_errors_total` | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ HTTP –æ—à–∏–±–æ–∫ | `sum(rate(http_errors_total[5m]))` |

## üéØ –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç

–ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –≤—Å–µ—Ö –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π:
- ‚úÖ –ù–µ—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ –ø–æ—Ä—Ç–æ–≤
- ‚úÖ –ú–µ—Ç—Ä–∏–∫–∏ —Å–æ–±–∏—Ä–∞—é—Ç—Å—è –∏–∑ auth-service
- ‚úÖ –î–∞—à–±–æ—Ä–¥—ã –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç —Ä–µ–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
- ‚úÖ –õ–æ–≥–∏, –º–µ—Ç—Ä–∏–∫–∏ –∏ —Ç—Ä–µ–π—Å—ã —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- ‚úÖ –î–æ—Å—Ç—É–ø–µ–Ω –¥–µ—Ç–∞–ª—å–Ω—ã–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ auth-service

## üö® –ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –≤—Å–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –∑–∞–ø—É—â–µ–Ω—ã: `docker ps`
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ —Å–µ—Ä–≤–∏—Å–æ–≤: `docker logs <container_name>`
3. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Å–µ—Ç—å `quark-network` —Å–æ–∑–¥–∞–Ω–∞: `docker network ls`
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –ø–æ—Ä—Ç–æ–≤: `netstat -tulpn | grep -E "(3000|9090|3001|9464)"`

–ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã –æ—Å—Ç–∞—é—Ç—Å—è, –ø—Ä–µ–¥–æ—Å—Ç–∞–≤—å—Ç–µ –ª–æ–≥–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ –¥–ª—è –¥–∞–ª—å–Ω–µ–π—à–µ–π –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏.