
### **"–ù–∞—Å—Ç—Ä–æ–π MinIO –∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –¥–ª—è media-service –≤ –ø—Ä–æ–µ–∫—Ç–µ Quark"**

```text
–¢—ã ‚Äî DevOps-–∏–Ω–∂–µ–Ω–µ—Ä –∏ full-stack —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫. –¢–≤–æ—è –∑–∞–¥–∞—á–∞ ‚Äî **–ø–æ–ª–Ω–æ—Å—Ç—å—é –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å MinIO –∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è** –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π —Ä–∞–±–æ—Ç—ã `media-service` –≤ –ø—Ä–æ–µ–∫—Ç–µ Quark.

–¶–µ–ª—å: –æ–±–µ—Å–ø–µ—á–∏—Ç—å —Å—Ç–∞–±–∏–ª—å–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ –º–µ–¥–∏–∞—Ñ–∞–π–ª–æ–≤, –¥–æ—Å—Ç—É–ø –∫ –Ω–∏–º –∏ –±–µ–∑–æ–ø–∞—Å–Ω—É—é –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é —Å `media-service`.

---

### üìÅ –®–∞–≥ 1: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è MinIO

1. –£–±–µ–¥–∏—Å—å, —á—Ç–æ MinIO –∑–∞–ø—É—â–µ–Ω:
   ```bash
   docker-compose ps minio
   ```

2. –ï—Å–ª–∏ –Ω–µ –∑–∞–ø—É—â–µ–Ω ‚Äî –∑–∞–ø—É—Å—Ç–∏:
   ```bash
   docker-compose up -d minio
   ```

3. –ü—Ä–æ–≤–µ—Ä—å, —á—Ç–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —Ä–∞–±–æ—Ç–∞–µ—Ç:
   ```bash
   docker-compose logs minio
   ```

---

### üåê –®–∞–≥ 2: –î–æ—Å—Ç—É–ø –∫ MinIO Console

1. –û—Ç–∫—Ä–æ–π –≤ –±—Ä–∞—É–∑–µ—Ä–µ:  
   üëâ **http://localhost:9001**

2. –í–æ–π–¥–∏ —Å –¥–∞–Ω–Ω—ã–º–∏:
   - **Login**: `minioadmin`
   - **Password**: `minioadmin`

3. –£–±–µ–¥–∏—Å—å, —á—Ç–æ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–æ—Å—Ç—É–ø–µ–Ω.

---

### ü™£ –®–∞–≥ 3: –°–æ–∑–¥–∞–Ω–∏–µ –±–∞–∫–µ—Ç–∞ `quark-media`

1. –í MinIO Console:
   - –ù–∞–∂–º–∏ **"Create Bucket"**
   - –ò–º—è: `quark-media`
   - Region: `local`
   - ACL: `private` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)

2. –ò–ª–∏ —á–µ—Ä–µ–∑ CLI:
   ```bash
   docker-compose exec minio /bin/sh
   # –í–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞:
   mc alias set local http://localhost:9000 minioadmin minioadmin
   mc mb local/quark-media
   mc policy set public local/quark-media  # –∏–ª–∏ 'none' –¥–ª—è –ø—Ä–∏–≤–∞—Ç–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞
   exit
   ```

---

### üîê –®–∞–≥ 4: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è –¥–ª—è `media-service`

–°–æ–∑–¥–∞–π —Ñ–∞–π–ª `.env` –≤ `/var/www/quark/services/media-service/.env`:

```env
# MinIO Configuration
MINIO_ENDPOINT=minio
MINIO_PORT=9000
MINIO_USE_SSL=false
MINIO_ACCESS_KEY=minioadmin
MINIO_SECRET_KEY=minioadmin
MINIO_BUCKET=quark-media

# Service Configuration
PORT=3003

# JWT Configuration (–¥–ª—è –∑–∞—â–∏—Ç—ã –∑–∞–≥—Ä—É–∑–∫–∏)
JWT_SECRET=your-super-secret-jwt-key-change-in-production
JWT_EXPIRES_IN=3600

# CORS (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
CORS_ORIGINS=http://localhost:8080,http://localhost:3000
```

–°–æ–∑–¥–∞–π —Ç–∞–∫–∂–µ `.env.example` (–±–µ–∑ —Å–µ–∫—Ä–µ—Ç–æ–≤):

```env
MINIO_ENDPOINT=minio
MINIO_PORT=9000
MINIO_USE_SSL=false
MINIO_ACCESS_KEY=minioadmin
MINIO_SECRET_KEY=minioadmin
MINIO_BUCKET=quark-media
PORT=3003
JWT_SECRET=your-secret-here
```

---

### üîÑ –®–∞–≥ 5: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ docker-compose.yml

–£–±–µ–¥–∏—Å—å, —á—Ç–æ —Å–µ—Ä–≤–∏—Å `media-service` –≤ `/var/www/quark/docker-compose.yml` —Å–æ–¥–µ—Ä–∂–∏—Ç:

```yaml
  media-service:
    build: ./services/media-service
    ports:
      - "3003:3003"
    environment:
      - MINIO_ENDPOINT=${MINIO_ENDPOINT:-minio}
      - MINIO_PORT=${MINIO_PORT:-9000}
      - MINIO_USE_SSL=${MINIO_USE_SSL:-false}
      - MINIO_ACCESS_KEY=${MINIO_ACCESS_KEY:-minioadmin}
      - MINIO_SECRET_KEY=${MINIO_SECRET_KEY:-minioadmin}
      - MINIO_BUCKET=${MINIO_BUCKET:-quark-media}
      - PORT=3003
      - JWT_SECRET=${JWT_SECRET}
    env_file:
      - ./services/media-service/.env
    depends_on:
      - minio
      - auth-service
    restart: unless-stopped
```

> ‚ö†Ô∏è –£–±–µ–¥–∏—Å—å, —á—Ç–æ `.env` —Ñ–∞–π–ª **–Ω–∞—Ö–æ–¥–∏—Ç—Å—è –Ω–∞ –º–µ—Å—Ç–µ**, –∏–Ω–∞—á–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –Ω–µ –ø–æ–¥—Ö–≤–∞—Ç—è—Ç—Å—è.

---

### üß™ –®–∞–≥ 6: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ media-service

1. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏ —Å–µ—Ä–≤–∏—Å:
   ```bash
   docker-compose up -d --build media-service
   ```

2. –ü—Ä–æ–≤–µ—Ä—å –ª–æ–≥–∏:
   ```bash
   docker-compose logs media-service
   ```
   –£–±–µ–¥–∏—Å—å, —á—Ç–æ –Ω–µ—Ç –æ—à–∏–±–æ–∫ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ MinIO.

3. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π –∑–∞–≥—Ä—É–∑–∫—É:
   ```bash
   curl -X POST http://localhost:3003/media/upload \
     -H "Authorization: Bearer <valid-jwt>" \
     -F "file=@/path/to/photo.jpg"
   ```

4. –ü—Ä–æ–≤–µ—Ä—å –≤ MinIO Console:
   - –§–∞–π–ª –ø–æ—è–≤–∏–ª—Å—è –≤ –±–∞–∫–µ—Ç–µ `quark-media`
   - –ú–∏–Ω–∏–∞—Ç—é—Ä–∞ —Å–æ–∑–¥–∞–Ω–∞ (–µ—Å–ª–∏ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ)

---

### üîÅ –®–∞–≥ 7: –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ

–î–æ–±–∞–≤—å –≤ `main.ts` –∏–ª–∏ `bootstrap` —Å–µ—Ä–≤–∏—Å–∞ –ø—Ä–æ–≤–µ—Ä–∫—É –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ MinIO:

```ts
async function bootstrap() {
  const app = await NestFactory.create(AppModule);
  
  // –ü—Ä–æ–≤–µ—Ä–∫–∞ MinIO
  const minioService = app.get(MinioService);
  try {
    await minioService.checkBucket(); // –º–µ—Ç–æ–¥, –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ –±–∞–∫–µ—Ç–∞
    console.log('‚úÖ MinIO: –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ, –±–∞–∫–µ—Ç quark-media –¥–æ—Å—Ç—É–ø–µ–Ω');
  } catch (error) {
    console.error('‚ùå MinIO: –æ—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è', error);
    process.exit(1);
  }

  await app.listen(3003);
}
```

---

### ‚úÖ –®–∞–≥ 8: –§–∏–Ω–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞

–°–æ–∑–¥–∞–π —Ñ–∞–π–ª `/var/www/quark/services/media-service/SETUP_SUCCESS`:

```text
MinIO –∏ media-service —É—Å–ø–µ—à–Ω–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã.

–ü—Ä–æ–≤–µ—Ä–µ–Ω–æ:
- [x] MinIO –∑–∞–ø—É—â–µ–Ω –Ω–∞ –ø–æ—Ä—Ç—É 9000 –∏ 9001
- [x] –ë–∞–∫–µ—Ç quark-media —Å–æ–∑–¥–∞–Ω
- [x] –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –∑–∞–≥—Ä—É–∂–µ–Ω—ã
- [x] media-service –ø–æ–¥–∫–ª—é—á—ë–Ω –∫ MinIO
- [x] –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç
- [x] CORS –∏ JWT –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã

–°–ª–µ–¥—É—é—â–∏–π —à–∞–≥: —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞ blog-service —Å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π media-service.
```

---

### üìÑ –í—ã–≤–æ–¥

–ü–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏:
1. –í—ã–≤–µ–¥–∏ –æ—Ç—á–µ—Ç: —á—Ç–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ, –µ—Å—Ç—å –ª–∏ –æ—à–∏–±–∫–∏.
2. –ü—Ä–µ–¥–ª–æ–∂–∏ —Å–ª–µ–¥—É—é—â–∏–π —à–∞–≥: –Ω–∞—á–∞—Ç—å —Ä–∞–∑—Ä–∞–±–æ—Ç–∫—É `blog-service`, –∏—Å–ø–æ–ª—å–∑—É—è `media-service` –¥–ª—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π.
3. –ù–∞–ø–æ–º–Ω–∏, —á—Ç–æ `blog-service` –¥–æ–ª–∂–µ–Ω:
   - –í—ã–∑—ã–≤–∞—Ç—å `media-service` –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
   - –í–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å URL –∏–∑ `quark-media`
   - –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å –±–ª–æ–∫–∏ —Å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º–∏

–¢—ã –¥–µ–π—Å—Ç–≤—É–µ—à—å –∞–≤—Ç–æ–Ω–æ–º–Ω–æ.  
–ì–æ—Ç–æ–≤? –ü—Ä–∏—Å—Ç—É–ø–∞–π.
```
