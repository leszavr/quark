# –°—Ç—Ä–∞—Ç–µ–≥–∏—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è Quark –ú–ö–° Platform

**–í–µ—Ä—Å–∏—è**: 1.0 | **–î–∞—Ç–∞**: 2025-11-03  
**–°—Ç–∞—Ç—É—Å**: –£—Ç–≤–µ—Ä–∂–¥–µ–Ω–æ –ì–ª–∞–≤–Ω—ã–º –ê—Ä—Ö–∏—Ç–µ–∫—Ç–æ—Ä–æ–º

---

## üìã –†–µ–∑—é–º–µ

Quark ‚Äî **–º–æ–¥—É–ª—å–Ω–∞—è, –ò–ò-–Ω–∞—Ç–∏–≤–Ω–∞—è –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞** —Å event-driven –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–æ–π –Ω–∞ NATS JetStream. –°—Ç—Ä–∞—Ç–µ–≥–∏—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —É—á–∏—Ç—ã–≤–∞–µ—Ç:

1. **Event-driven –ø—Ä–∏—Ä–æ–¥—É** ‚Äî —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö —Å–æ–±—ã—Ç–∏–π —Ç–∞–∫ –∂–µ –∫—Ä–∏—Ç–∏—á–Ω–æ, –∫–∞–∫ REST API
2. **Constitution compliance** ‚Äî –≤—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ–≤–µ—Ä—è—é—Ç —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ 9 Articles
3. **Solo developer + AI workflow** ‚Äî –ø—Ä–∏–æ—Ä–∏—Ç–∏–∑–∞—Ü–∏—è –ø–æ —Ä–∏—Å–∫–∞–º, –∞–≤—Ç–æ–≥–µ–Ω–µ—Ä–∞—Ü–∏—è —Ç–µ—Å—Ç–æ–≤
4. **Production-grade —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è** ‚Äî –æ—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å –∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ø—Ä–æ–≤–µ—Ä—è—é—Ç—Å—è –≤ MVP

---

## üß≠ –û–±—â–∏–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã

### 1. –ú–æ–¥—É–ª—å–Ω–æ—Å—Ç—å
–ö–∞–∂–¥—ã–π –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å –∏ –ø–ª–∞–≥–∏–Ω —Ç–µ—Å—Ç–∏—Ä—É–µ—Ç—Å—è **–Ω–µ–∑–∞–≤–∏—Å–∏–º–æ**. –ö–æ–Ω—Ç—Ä–∞–∫—Ç—ã (OpenAPI + AsyncAPI) ‚Äî –≥—Ä–∞–Ω–∏—Ü–∞ –∏–∑–æ–ª—è—Ü–∏–∏.

### 2. –ß–µ–ª–æ–≤–µ–∫ –≤ —Ü–∏–∫–ª–µ
–¢–µ—Å—Ç—ã –Ω–µ —Ç–æ–ª—å–∫–æ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω—ã, –Ω–æ –∏ **–∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∏—Ä—É—é—Ç—Å—è —á–µ–ª–æ–≤–µ–∫–æ–º** —á–µ—Ä–µ–∑ –º–µ—Ç—Ä–∏–∫–∏ –∏ –æ—Ç—á—ë—Ç—ã.

### 3. –ò–ò-–Ω–∞—Ç–∏–≤–Ω–æ—Å—Ç—å
AI —É—á–∞—Å—Ç–≤—É–µ—Ç –≤:
- –ì–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Ç–µ—Å—Ç-–∫–µ–π—Å–æ–≤ –∏–∑ —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–π
- –ê–Ω–∞–ª–∏–∑–µ –ø–æ–∫—Ä—ã—Ç–∏—è –∏ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–∏ —É–ª—É—á—à–µ–Ω–∏–π
- –°–∞–º–æ–≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—â–∏—Ö—Å—è UI-—Ç–µ—Å—Ç–∞—Ö (Playwright + AI)

### 4. –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∫–∞–∫ —á–∞—Å—Ç—å —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
**Snyk** + **SAST/DAST** –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω—ã –≤ CI/CD –ø–∞–π–ø–ª–∞–π–Ω. Zero tolerance –¥–ª—è high/critical —É—è–∑–≤–∏–º–æ—Å—Ç–µ–π.

### 5. Observability-driven testing
–ú–µ—Ç—Ä–∏–∫–∏ (Prometheus), —Ç—Ä–µ–π—Å—ã (OpenTelemetry) –∏ –ª–æ–≥–∏ (Grafana Loki) –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –¥–ª—è **–≤–∞–ª–∏–¥–∞—Ü–∏–∏ –ø–æ–≤–µ–¥–µ–Ω–∏—è** —Å–∏—Å—Ç–µ–º—ã.

---

## üß™ –£—Ä–æ–≤–Ω–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### üîµ –ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å —Ç–µ—Å—Ç–æ–≤ (Must-have vs Should-have vs Nice-to-have)

| –£—Ä–æ–≤–µ–Ω—å | –ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å | –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è AI | –°—Ä–µ–¥–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è |
|---------|-------------|-----------------|------------------|
| **Contract Tests** | ‚úÖ Must-have | –î–∞ | –õ–æ–∫–∞–ª—å–Ω–æ + CI |
| **Integration Tests** | ‚úÖ Must-have | –ß–∞—Å—Ç–∏—á–Ω–æ | Testcontainers |
| **Minimal Chaos** | ‚úÖ Must-have | –î–∞ | Testcontainers |
| **Minimal Performance** | ‚úÖ Must-have | –î–∞ | –õ–æ–∫–∞–ª—å–Ω–æ + CI |
| **Unit Tests** (–∫—Ä–∏—Ç–∏—á–Ω–æ–µ) | ‚ö†Ô∏è Should-have | –î–∞ | –õ–æ–∫–∞–ª—å–Ω–æ + CI |
| **E2E** (–∫—Ä–∏—Ç–∏—á–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏) | ‚ö†Ô∏è Should-have | –®–∞–±–ª–æ–Ω—ã | docker-compose |
| **Full Chaos Suite** | üîµ Nice-to-have | –ù–µ—Ç | Staging/Production |
| **Load Testing** (100+ RPS) | üîµ Nice-to-have | –ù–µ—Ç | Staging |

---

## 1Ô∏è‚É£ Contract Testing

> **–¶–µ–ª—å**: –ì–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å –º–µ–∂–¥—É —Å–µ—Ä–≤–∏—Å–∞–º–∏ —á–µ—Ä–µ–∑ –∫–æ–Ω—Ç—Ä–∞–∫—Ç—ã

### REST API Contracts

**–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã**: `spectral` (OpenAPI linter), `ajv` (JSON Schema validator)

**–ü—Ä–æ—Ü–µ—Å—Å**:
1. –í—Å–µ API-–∫–ª–∏–µ–Ω—Ç—ã –≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è –∏–∑ `specs/[###]/contracts/openapi.yaml`
2. –ü–µ—Ä–µ–¥ merge –≤ `main` ‚Üí –≤–∞–ª–∏–¥–∞—Ü–∏—è –∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤ –≤ CI
3. Mock API (Prism) –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è Frontend'–æ–º –¥–ª—è –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

**–ö–æ–º–∞–Ω–¥–∞**:
```bash
./quark-manager.sh spec:validate [###]
# ‚úÖ OpenAPI –≤–∞–ª–∏–¥–µ–Ω (spectral --ruleset .spectral.yaml)
# ‚úÖ –ü—Ä–∏–º–µ—Ä—ã –ø—Ä–æ—Ö–æ–¥—è—Ç –≤–∞–ª–∏–¥–∞—Ü–∏—é
```

**–ß—Ç–æ –ø—Ä–æ–≤–µ—Ä—è–µ–º**:
- ‚úÖ –í—Å–µ endpoints —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç OpenAPI schema
- ‚úÖ Response codes –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω—ã (200, 400, 401, 404, 500)
- ‚úÖ Security schemas –æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã (JWT Bearer)
- ‚úÖ –ü—Ä–∏–º–µ—Ä—ã –≤–∞–ª–∏–¥–Ω—ã (–∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –≤ mock API)

---

### Event Contracts (AsyncAPI)

**–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã**: `@asyncapi/cli`, `Pact` (–¥–ª—è message contracts)

**–ö–†–ò–¢–ò–ß–ù–û**: Quark ‚Äî **event-driven –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞**. REST ‚Äî —Ç–æ–ª—å–∫–æ –≤–Ω–µ—à–Ω–∏–π API. –û—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞ –∏–¥—ë—Ç —á–µ—Ä–µ–∑ **NATS JetStream**.

**–ü—Ä–æ—Ü–µ—Å—Å**:
1. –í—Å–µ published/subscribed —Å–æ–±—ã—Ç–∏—è –æ–ø–∏—Å–∞–Ω—ã –≤ `specs/[###]/contracts/asyncapi.yaml`
2. Pact Message Contracts –ø—Ä–æ–≤–µ—Ä—è—é—Ç **consumer expectations**
3. Dead Letter Queue (DLQ) –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–∞ –¥–ª—è –≤—Å–µ—Ö subscribers

**–ö–æ–º–∞–Ω–¥–∞**:
```bash
./quark-manager.sh spec:validate [###]
# ‚úÖ AsyncAPI –≤–∞–ª–∏–¥–µ–Ω (@asyncapi/cli validate)
# ‚úÖ –í—Å–µ —Å–æ–±—ã—Ç–∏—è –∏–º–µ—é—Ç JSON Schema –¥–ª—è payload
# ‚úÖ DLQ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞ (dead_letter_subject)
```

**–ß—Ç–æ –ø—Ä–æ–≤–µ—Ä—è–µ–º**:
- ‚úÖ Publisher —Å–æ–±–ª—é–¥–∞–µ—Ç payload schema
- ‚úÖ Subscriber –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Å–æ–±—ã—Ç–∏—è
- ‚úÖ Ack policy = explicit (–Ω–µ auto)
- ‚úÖ Max delivery attempts –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã (‚Üí DLQ –ø–æ—Å–ª–µ 3 –ø–æ–ø—ã—Ç–æ–∫)

**–ü—Ä–∏–º–µ—Ä Pact Message Contract**:
```typescript
// tests/contract/events.message.spec.ts
describe('user.created event', () => {
  it('–¥–æ–ª–∂–µ–Ω —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–æ–≤–∞—Ç—å –∫–æ–Ω—Ç—Ä–∞–∫—Ç—É', async () => {
    const message = {
      id: '123e4567-e89b-12d3-a456-426614174000',
      username: 'testuser',
      email: 'test@example.com',
      created_at: '2025-11-03T10:00:00Z'
    };
    
    // –í–∞–ª–∏–¥–∞—Ü–∏—è –ø—Ä–æ—Ç–∏–≤ AsyncAPI schema
    const valid = await validateAgainstAsyncAPI('user.created', message);
    expect(valid).toBe(true);
  });
});
```

---

### UDI Compliance

**–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã**: Jest + Supertest

**–ß—Ç–æ –ø—Ä–æ–≤–µ—Ä—è–µ–º**:
- ‚úÖ `/manifest` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –≤–∞–ª–∏–¥–Ω—ã–π `module-manifest.yaml`
- ‚úÖ `/health` –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ <1s (liveness probe)
- ‚úÖ `/status` —Å–æ–¥–µ—Ä–∂–∏—Ç –¥–µ—Ç–∞–ª—å–Ω—ã–µ dependency checks (readiness probe)

**–ü—Ä–∏–º–µ—Ä**:
```typescript
describe('UDI Compliance', () => {
  it('/manifest –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤–∞–ª–∏–¥–Ω—ã–º YAML', async () => {
    const response = await request(app).get('/manifest');
    expect(response.status).toBe(200);
    const manifest = yaml.parse(response.text);
    expect(manifest.version).toMatch(/^\d+\.\d+\.\d+$/);
  });
});
```

---

## 2Ô∏è‚É£ Integration Testing

> **–¶–µ–ª—å**: –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ —Å–µ—Ä–≤–∏—Å–∞–º–∏

**–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã**: `Testcontainers` (Node.js/Python), Jest/pytest

### –ü–æ—á–µ–º—É Testcontainers, –∞ –Ω–µ docker-compose?

| –ö—Ä–∏—Ç–µ—Ä–∏–π | Testcontainers | docker-compose |
|----------|----------------|----------------|
| –ò–∑–æ–ª—è—Ü–∏—è | ‚úÖ –ö–∞–∂–¥—ã–π —Ç–µ—Å—Ç = —á–∏—Å—Ç—ã–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä | ‚ùå –°–æ—Å—Ç–æ—è–Ω–∏–µ "—É—Ç–µ–∫–∞–µ—Ç" –º–µ–∂–¥—É —Ç–µ—Å—Ç–∞–º–∏ |
| CI/CD | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç –≤ GitHub Actions –±–µ–∑ DinD | ‚ö†Ô∏è –¢—Ä–µ–±—É–µ—Ç Docker-in-Docker |
| –°–∫–æ—Ä–æ—Å—Ç—å | ‚ö†Ô∏è –ú–µ–¥–ª–µ–Ω–Ω–µ–µ (~10s overhead) | ‚úÖ –ë—ã—Å—Ç—Ä–µ–µ |
| –ù–∞–¥—ë–∂–Ω–æ—Å—Ç—å | ‚úÖ –ü–æ–≤—Ç–æ—Ä—è–µ–º–æ—Å—Ç—å 100% | ‚ùå Flaky –∏–∑-–∑–∞ shared state |

**–í–µ—Ä–¥–∏–∫—Ç**: –î–ª—è Quark (production-grade) ‚Üí **Testcontainers**.

### –°—Ü–µ–Ω–∞—Ä–∏–∏

#### NATS JetStream Integration
```typescript
// tests/integration/nats.integration.spec.ts
describe('NATS Events', () => {
  let container: StartedTestContainer;
  
  beforeAll(async () => {
    container = await new GenericContainer('nats:2.10-alpine')
      .withExposedPorts(4222)
      .withCommand(['-js']) // Enable JetStream
      .start();
  });
  
  it('–¥–æ–ª–∂–µ–Ω –ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å –∏ –ø–æ–ª—É—á–∞—Ç—å —Å–æ–±—ã—Ç–∏–µ user.created', async () => {
    const nc = await connect({ servers: `localhost:${container.getMappedPort(4222)}` });
    const js = nc.jetstream();
    
    // Publish
    await js.publish('user.created', JSON.stringify({ id: '123', username: 'test' }));
    
    // Subscribe
    const consumer = await js.consumers.get('USER_STREAM', 'test-consumer');
    const messages = await consumer.fetch({ max_messages: 1 });
    
    expect(messages[0].subject).toBe('user.created');
    expect(JSON.parse(messages[0].data)).toMatchObject({ id: '123' });
  });
});
```

#### Database Integration
```typescript
// tests/integration/database.integration.spec.ts
describe('PostgreSQL', () => {
  let container: StartedPostgreSqlContainer;
  
  beforeAll(async () => {
    container = await new PostgreSqlContainer('postgres:16-alpine').start();
  });
  
  it('–¥–æ–ª–∂–µ–Ω —Å–æ—Ö—Ä–∞–Ω—è—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å —É–Ω–∏–∫–∞–ª—å–Ω—ã–º username', async () => {
    const repo = getRepository(User);
    await repo.save({ username: 'test', email: 'test@example.com' });
    
    // Duplicate username ‚Üí –¥–æ–ª–∂–µ–Ω —É–ø–∞—Å—Ç—å
    await expect(repo.save({ username: 'test', email: 'other@example.com' }))
      .rejects.toThrow('duplicate key value violates unique constraint');
  });
});
```

#### Vault Integration
```typescript
// tests/integration/vault.integration.spec.ts
describe('HashiCorp Vault', () => {
  it('–¥–æ–ª–∂–µ–Ω —Ä–æ—Ç–∏—Ä–æ–≤–∞—Ç—å JWT —Å–µ–∫—Ä–µ—Ç—ã', async () => {
    const client = new VaultClient({ endpoint: container.getEndpoint() });
    
    const secret1 = await client.read('secret/data/quark/user-service/jwt');
    await client.write('secret/data/quark/user-service/jwt', { key: 'new-secret' });
    const secret2 = await client.read('secret/data/quark/user-service/jwt');
    
    expect(secret1.data.key).not.toBe(secret2.data.key);
  });
});
```

---

## 3Ô∏è‚É£ Unit Testing

> **–¶–µ–ª—å**: –ò–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏

**–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã**:
- Backend (Python): `pytest` + `unittest.mock`
- Backend (TypeScript): `Jest` + `ts-mockito`
- Frontend: `Vitest` + `React Testing Library`

### –ü—Ä–∏–æ—Ä–∏—Ç–∏–∑–∞—Ü–∏—è (–¥–ª—è solo dev + AI)

**Must-test** (‚â•90% coverage):
1. **Auth –ª–æ–≥–∏–∫–∞** ‚Äî JWT validation, role checks, permission guards
2. **Payment/Subscription –ª–æ–≥–∏–∫–∞** ‚Äî billing, trial periods, VIP upgrades
3. **–í–∞–ª–∏–¥–∞—Ç–æ—Ä—ã** ‚Äî email, phone, content moderation (AI safety)

**Should-test** (‚â•70% coverage):
4. Domain services (CreatePostUseCase, SendMessageUseCase)
5. Custom validators (class-validator)

**Nice-to-test** (‚â•50% coverage):
6. Utilities, helpers, formatters

### AI-Generated Unit Tests

**–ö–æ–º–∞–Ω–¥–∞**:
```bash
./quark-manager.sh spec:generate-tests [###] --type=unit
# –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Ç–µ—Å—Ç—ã –∏–∑ OpenAPI schemas + spec.md (Functional Requirements)
```

**–ü—Ä–∏–º–µ—Ä —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ —Ç–µ—Å—Ç–∞**:
```typescript
// tests/unit/subscription.service.spec.ts
describe('SubscriptionService', () => {
  it('–¥–æ–ª–∂–µ–Ω –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å VIP –ø–æ–¥–ø–∏—Å–∫—É –Ω–∞ 30 –¥–Ω–µ–π', async () => {
    const service = new SubscriptionService(mockRepo);
    const result = await service.activateVIP(userId, 'monthly');
    
    expect(result.type).toBe('VIP');
    expect(result.expires_at).toBeCloseTo(Date.now() + 30*24*60*60*1000, -3);
  });
  
  it('–¥–æ–ª–∂–µ–Ω –∑–∞–ø—Ä–µ—Ç–∏—Ç—å —Å–æ–∑–¥–∞–Ω–∏–µ –≤—Ç–æ—Ä–æ–π –∞–∫—Ç–∏–≤–Ω–æ–π –ø–æ–¥–ø–∏—Å–∫–∏', async () => {
    const service = new SubscriptionService(mockRepo);
    await service.activateVIP(userId, 'monthly');
    
    await expect(service.activateVIP(userId, 'yearly'))
      .rejects.toThrow('User already has an active subscription');
  });
});
```

---

## 4Ô∏è‚É£ Chaos Testing

> **–¶–µ–ª—å**: –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç–∏ event-driven –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

**–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã**: `Toxiproxy`, `Chaos Mesh` (–¥–ª—è k8s)

### –ü–æ—á–µ–º—É –Ω–µ –æ—Ç–∫–ª–∞–¥—ã–≤–∞—Ç—å –¥–æ production?

Event-driven –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ **—Ö—Ä—É–ø–∫–∞—è –±–µ–∑ retry logic**. –ü—Ä–æ—Å—Ç—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ —Ç–∏–ø–∞ "NATS disconnect ‚Üí retry ‚Üí reconnect" –º–æ–∂–Ω–æ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å **–Ω–∞ —ç—Ç–∞–ø–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –ø–µ—Ä–≤–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞**.

**–¶–µ–Ω–∞**: 30-60 –º–∏–Ω—É—Ç –Ω–∞ –±–∞–∑–æ–≤—ã–π chaos —Ç–µ—Å—Ç.  
**–í—ã–≥–æ–¥–∞**: –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ –∫–∞—Ç–∞—Å—Ç—Ä–æ—Ñ—ã –≤ production (MTTR —Å–Ω–∏–∂–∞–µ—Ç—Å—è —Å —á–∞—Å–æ–≤ –¥–æ –º–∏–Ω—É—Ç).

### Minimal Must-Have Chaos Tests

#### 1. NATS Disconnect
```typescript
// tests/chaos/nats-disconnect.chaos.spec.ts
describe('NATS Disconnect', () => {
  it('–¥–æ–ª–∂–µ–Ω –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —á–µ—Ä–µ–∑ retry', async () => {
    const proxy = new Toxiproxy({ host: 'localhost', port: 8474 });
    const natsProxy = await proxy.create({
      name: 'nats',
      listen: '127.0.0.1:4223',
      upstream: 'nats:4222'
    });
    
    // –°–µ—Ä–≤–∏—Å –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ proxy
    const service = new UserService({ natsUrl: 'nats://localhost:4223' });
    
    // –û—Ç–∫–ª—é—á–∞–µ–º NATS –Ω–∞ 5 —Å–µ–∫—É–Ω–¥
    await natsProxy.toxic({ type: 'timeout', attributes: { timeout: 5000 } });
    
    // –ü—É–±–ª–∏–∫—É–µ–º —Å–æ–±—ã—Ç–∏–µ ‚Üí –¥–æ–ª–∂–Ω–æ –ø–æ–ø–∞—Å—Ç—å –≤ retry queue
    await service.createUser({ username: 'test' });
    
    // –ñ–¥—ë–º 6 —Å–µ–∫—É–Ω–¥ ‚Üí —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ
    await sleep(6000);
    
    // –°–æ–±—ã—Ç–∏–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –¥–æ—Å—Ç–∞–≤–ª–µ–Ω–æ
    const messages = await consumeMessages('user.created', 1);
    expect(messages[0].data.username).toBe('test');
  });
});
```

#### 2. Database Latency
```typescript
// tests/chaos/db-latency.chaos.spec.ts
describe('Database Latency', () => {
  it('–¥–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å timeout error –ø—Ä–∏ –∑–∞–¥–µ—Ä–∂–∫–µ >5s', async () => {
    const proxy = new Toxiproxy({ host: 'localhost', port: 8474 });
    const dbProxy = await proxy.create({
      name: 'postgres',
      listen: '127.0.0.1:5433',
      upstream: 'postgres:5432'
    });
    
    // –î–æ–±–∞–≤–ª—è–µ–º –∑–∞–¥–µ—Ä–∂–∫—É 6 —Å–µ–∫—É–Ω–¥
    await dbProxy.toxic({ type: 'latency', attributes: { latency: 6000 } });
    
    // –ó–∞–ø—Ä–æ—Å –¥–æ–ª–∂–µ–Ω —É–ø–∞—Å—Ç—å —Å timeout
    await expect(service.getUser('123'))
      .rejects.toThrow('Query timeout');
  });
});
```

#### 3. Vault Unavailable
```typescript
// tests/chaos/vault-unavailable.chaos.spec.ts
describe('Vault Unavailable', () => {
  it('–¥–æ–ª–∂–µ–Ω –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–Ω—ã–π JWT —Å–µ–∫—Ä–µ—Ç', async () => {
    // –ü–æ–ª—É—á–∞–µ–º —Å–µ–∫—Ä–µ—Ç –æ–¥–∏–Ω —Ä–∞–∑ (–∫—ç—à–∏—Ä—É–µ—Ç—Å—è –Ω–∞ 5 –º–∏–Ω—É—Ç)
    const token = await service.validateJWT('valid-token');
    
    // –û—Ç–∫–ª—é—á–∞–µ–º Vault
    await vaultProxy.disable();
    
    // –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Å—ë –µ—â—ë –¥–æ–ª–∂–Ω–∞ —Ä–∞–±–æ—Ç–∞—Ç—å (–∏–∑ –∫—ç—à–∞)
    const token2 = await service.validateJWT('valid-token');
    expect(token2).toEqual(token);
  });
});
```

### Advanced Chaos (Nice-to-have –¥–ª—è Production)

- **Network partition** ‚Äî split brain scenarios
- **CPU throttling** ‚Äî –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä –Ω–∞ 100%
- **Memory pressure** ‚Äî OOM killer
- **Cascading failures** ‚Äî –æ–¥–∏–Ω —Å–µ—Ä–≤–∏—Å –ø–∞–¥–∞–µ—Ç ‚Üí –≤—Å–µ –∑–∞–≤–∏—Å–∏–º—ã–µ —Ç–æ–∂–µ

---

## 5Ô∏è‚É£ Performance Testing

> **–¶–µ–ª—å**: –í—ã—è–≤–∏—Ç—å –≥—Ä—É–±—ã–µ –æ—à–∏–±–∫–∏ –¥–æ production

**–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã**: `k6`, `Locust`

### –ü–æ—á–µ–º—É –Ω–µ –æ—Ç–∫–ª–∞–¥—ã–≤–∞—Ç—å?

–ï—Å–ª–∏ —Å–µ—Ä–≤–∏—Å **–Ω–µ –≤—ã–¥–µ—Ä–∂–∏–≤–∞–µ—Ç 10 RPS** (–∏–∑-–∑–∞ N+1 queries, –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è –∏–Ω–¥–µ–∫—Å–æ–≤, memory leaks), –æ–Ω **–Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –¥–æ–±–µ—Ä—ë—Ç—Å—è –¥–æ 100 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π**.

### Minimal Must-Have Performance Tests

**Target**: 10 RPS (–Ω–µ 1000!) ‚Üí baseline –¥–ª—è –≤—ã—è–≤–ª–µ–Ω–∏—è –≥—Ä—É–±—ã—Ö –æ—à–∏–±–æ–∫.

#### k6 Baseline Script
```javascript
// tests/performance/baseline.load.js
import http from 'k6/http';
import { check, sleep } from 'k6';

export let options = {
  vus: 10,           // 10 –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
  duration: '1m',    // 1 –º–∏–Ω—É—Ç–∞
  thresholds: {
    http_req_duration: ['p(95)<500'],  // p95 < 500ms
    http_req_failed: ['rate<0.01'],    // error rate < 1%
  },
};

export default function () {
  // –ö—Ä–∏—Ç–∏—á–Ω—ã–µ endpoints
  let res1 = http.post('http://localhost:3000/api/v1/users', JSON.stringify({
    username: 'testuser',
    email: 'test@example.com'
  }), { headers: { 'Content-Type': 'application/json' } });
  
  check(res1, { 'status 201': (r) => r.status === 201 });
  
  let res2 = http.get(`http://localhost:3000/api/v1/users/${res1.json('id')}`);
  check(res2, { 'status 200': (r) => r.status === 200 });
  
  sleep(1);
}
```

**–ó–∞–ø—É—Å–∫**:
```bash
k6 run tests/performance/baseline.load.js
```

**–ß—Ç–æ –ø—Ä–æ–≤–µ—Ä—è–µ–º**:
- ‚úÖ p95 latency < 500ms
- ‚úÖ Error rate < 1%
- ‚úÖ CPU < 80%
- ‚úÖ Memory < 1GB
- ‚úÖ Database connection pool –Ω–µ –∏—Å—Ç–æ—â–∞–µ—Ç—Å—è

### Advanced Performance (Nice-to-have)

- **Spike testing** ‚Äî —Ä–µ–∑–∫–∏–π —Å–∫–∞—á–æ–∫ —Å 10 –¥–æ 100 RPS
- **Soak testing** ‚Äî –¥–ª–∏—Ç–µ–ª—å–Ω–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞ (8 —á–∞—Å–æ–≤) –¥–ª—è –≤—ã—è–≤–ª–µ–Ω–∏—è memory leaks
- **Stress testing** ‚Äî —É–≤–µ–ª–∏—á–µ–Ω–∏–µ –Ω–∞–≥—Ä—É–∑–∫–∏ –¥–æ —Ç–æ—á–∫–∏ –æ—Ç–∫–∞–∑–∞

---

## 6Ô∏è‚É£ End-to-End (E2E) Testing

> **–¶–µ–ª—å**: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–∫–≤–æ–∑–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤

**–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã**: `Playwright` (–ø–æ–¥–¥–µ—Ä–∂–∫–∞ Chromium, Firefox, WebKit + –º–æ–±–∏–ª—å–Ω—ã–µ —ç–º—É–ª—è—Ü–∏–∏)

### –ü—Ä–∏–æ—Ä–∏—Ç–∏–∑–∞—Ü–∏—è (–¥–ª—è solo dev + AI)

**–ö—Ä–∏—Ç–∏—á–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏** (Must-test):
1. **Auth flow** ‚Äî —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è ‚Üí –≤—Ö–æ–¥ ‚Üí JWT ‚Üí –∑–∞—â–∏—â—ë–Ω–Ω—ã–π endpoint
2. **Core business flow** ‚Äî —Å–æ–∑–¥–∞–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–∞ ‚Üí event ‚Üí –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ UI
3. **Real-time flow** ‚Äî WebSocket ‚Üí NATS event ‚Üí notification

**–í–∞–∂–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏** (Should-test):
4. VIP subscription ‚Üí role change ‚Üí access granted
5. Blog post ‚Üí AI moderation ‚Üí publish/reject
6. Message send ‚Üí online status check ‚Üí delivery

### –£–º–Ω—ã–µ —Ç—Ä–∏–≥–≥–µ—Ä—ã (–Ω–µ "–≤—Å—ë –∏–ª–∏ –Ω–∏—á–µ–≥–æ")

**–ü—Ä–æ–±–ª–µ–º–∞**: E2E —Ç–µ—Å—Ç—ã –º–µ–¥–ª–µ–Ω–Ω—ã–µ (5-10 –º–∏–Ω—É—Ç).

**–†–µ—à–µ–Ω–∏–µ**: –ó–∞–ø—É—Å–∫–∞—Ç—å —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ UI –∏–ª–∏ API contracts:
```bash
# .gitlab-ci.yml
test:e2e:
  rules:
    - changes:
        - contracts/**/*
        - infra/quark-ui/src/**/*
  script:
    - docker-compose -f docker-compose.e2e.yml up -d
    - npm run test:e2e
```

### AI-Generated E2E Tests

**–ö–æ–º–∞–Ω–¥–∞**:
```bash
./quark-manager.sh spec:generate-tests [###] --type=e2e
# –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç Playwright —Ç–µ—Å—Ç—ã –∏–∑ user stories (spec.md)
```

**–ü—Ä–∏–º–µ—Ä**:
```typescript
// tests/e2e/user-registration.e2e.spec.ts
test('–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è –∏ —Å–æ–∑–¥–∞—Ç—å –ø–æ—Å—Ç', async ({ page }) => {
  // 1. –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
  await page.goto('http://localhost:8080/register');
  await page.fill('input[name="username"]', 'testuser');
  await page.fill('input[name="email"]', 'test@example.com');
  await page.fill('input[name="password"]', 'SecurePass123!');
  await page.click('button[type="submit"]');
  
  // 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ JWT –≤ localStorage
  const token = await page.evaluate(() => localStorage.getItem('jwt'));
  expect(token).toBeTruthy();
  
  // 3. –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ—Å—Ç–∞
  await page.goto('http://localhost:8080/posts/new');
  await page.fill('textarea[name="content"]', '–ú–æ–π –ø–µ—Ä–≤—ã–π –ø–æ—Å—Ç!');
  await page.click('button:has-text("–û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å")');
  
  // 4. –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ –ª–µ–Ω—Ç–µ
  await page.waitForSelector('text=–ú–æ–π –ø–µ—Ä–≤—ã–π –ø–æ—Å—Ç!');
  expect(await page.locator('text=testuser').count()).toBeGreaterThan(0);
});
```

### Self-Healing Tests (AI-powered)

Playwright + AI –º–æ–∂–µ—Ç **–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–µ–ª–µ–∫—Ç–æ—Ä—ã** –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö UI:
```typescript
// –í–º–µ—Å—Ç–æ –∂—ë—Å—Ç–∫–∏—Ö —Å–µ–ª–µ–∫—Ç–æ—Ä–æ–≤:
await page.click('button.submit-btn');

// AI –Ω–∞—Ö–æ–¥–∏—Ç –∫–Ω–æ–ø–∫—É –ø–æ —Å–º—ã—Å–ª—É:
await page.click('button:has-text("–û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å")');
```

---

## 7Ô∏è‚É£ AI-Specific Testing

> **–¶–µ–ª—å**: –í–∞–ª–∏–¥–∞—Ü–∏—è –ø–æ–≤–µ–¥–µ–Ω–∏—è –ò–ò-–∞–≥–µ–Ω—Ç–æ–≤

### –ü—Ä–æ–±–ª–µ–º–∞: LLM ‚Äî –Ω–µ–¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ

**–†–µ—à–µ–Ω–∏–µ**: Deterministic mocks + golden datasets + bias checks

### 7.1 Deterministic Mocks

**–ü–æ–¥—Ö–æ–¥**: –ó–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å –æ—Ç–≤–µ—Ç—ã LLM –¥–ª—è –ø–æ–≤—Ç–æ—Ä—è–µ–º–æ—Å—Ç–∏ —Ç–µ—Å—Ç–æ–≤.

```typescript
// tests/ai/llm.mock.spec.ts
describe('AI Blog Post Generator', () => {
  it('–¥–æ–ª–∂–µ–Ω –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –ø–æ—Å—Ç –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø—Ä–æ–º–ø—Ç–∞', async () => {
    // Mock LLM response
    const mockLLM = jest.fn().mockResolvedValue({
      text: '–≠—Ç–æ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π AI –ø–æ—Å—Ç –æ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—è—Ö...',
      tokens: 150
    });
    
    const service = new AIBlogService({ llm: mockLLM });
    const result = await service.generatePost('—Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏ –±—É–¥—É—â–µ–≥–æ');
    
    expect(result.text).toContain('—Ç–µ—Ö–Ω–æ–ª–æ–≥–∏');
    expect(mockLLM).toHaveBeenCalledWith(expect.objectContaining({
      prompt: expect.stringContaining('—Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏ –±—É–¥—É—â–µ–≥–æ')
    }));
  });
});
```

### 7.2 Golden Datasets

**–ü–æ–¥—Ö–æ–¥**: –≠—Ç–∞–ª–æ–Ω–Ω—ã–µ –≤—Ö–æ–¥—ã/–≤—ã—Ö–æ–¥—ã –¥–ª—è `ai-orchestrator`.

```typescript
// tests/ai/golden.spec.ts
const GOLDEN_CASES = [
  {
    input: '–ù–∞–ø–∏—à–∏ –∫–æ—Ä–æ—Ç–∫–∏–π –ø–æ—Å—Ç –æ Python',
    expected: { length: [100, 500], mentions: ['Python'] }
  },
  {
    input: '–ü—Ä–æ–º–æ–¥–µ—Ä–∏—Ä—É–π —ç—Ç–æ—Ç —Ç–µ–∫—Å—Ç: "–Ø —Ç–µ–±—è –Ω–µ–Ω–∞–≤–∏–∂—É!"',
    expected: { toxic: true, action: 'reject' }
  }
];

describe('Golden Dataset Tests', () => {
  GOLDEN_CASES.forEach(({ input, expected }) => {
    it(`–¥–æ–ª–∂–µ–Ω –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å: "${input}"`, async () => {
      const result = await aiService.process(input);
      
      if (expected.length) {
        expect(result.text.length).toBeGreaterThanOrEqual(expected.length[0]);
        expect(result.text.length).toBeLessThanOrEqual(expected.length[1]);
      }
      
      if (expected.toxic) {
        expect(result.moderation.toxic).toBe(true);
      }
    });
  });
});
```

### 7.3 Bias & Safety Checks

**–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã**: `Guardrails`, –∫–∞—Å—Ç–æ–º–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏

```typescript
// tests/ai/safety.spec.ts
describe('AI Safety', () => {
  it('–¥–æ–ª–∂–µ–Ω –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å —Ç–æ–∫—Å–∏—á–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç', async () => {
    const toxic = '–Ø —Ç–µ–±—è –Ω–µ–Ω–∞–≤–∏–∂—É, –∏–¥–∏–æ—Ç!';
    const result = await aiService.moderate(toxic);
    
    expect(result.is_safe).toBe(false);
    expect(result.categories).toContain('toxicity');
  });
  
  it('–¥–æ–ª–∂–µ–Ω –ù–ï –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –±–µ–∑–æ–ø–∞—Å–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç', async () => {
    const safe = '–û—Ç–ª–∏—á–Ω–∞—è —Å—Ç–∞—Ç—å—è, —Å–ø–∞—Å–∏–±–æ!';
    const result = await aiService.moderate(safe);
    
    expect(result.is_safe).toBe(true);
  });
});
```

### 7.4 Latency/Accuracy SLA

**–ú–µ—Ç—Ä–∏–∫–∏** (—á–µ—Ä–µ–∑ OpenTelemetry):
- AI generation latency < 2s
- Moderation accuracy ‚â•95%
- Toxicity detection recall ‚â•98%

```typescript
// tests/ai/sla.spec.ts
describe('AI SLA', () => {
  it('–≥–µ–Ω–µ—Ä–∞—Ü–∏—è –¥–æ–ª–∂–Ω–∞ –∑–∞–Ω–∏–º–∞—Ç—å <2s', async () => {
    const start = Date.now();
    await aiService.generatePost('—Ç–µ–º–∞');
    const duration = Date.now() - start;
    
    expect(duration).toBeLessThan(2000);
  });
});
```

---

## 8Ô∏è‚É£ Security Testing

> **–¶–µ–ª—å**: Zero tolerance –¥–ª—è high/critical —É—è–∑–≤–∏–º–æ—Å—Ç–µ–π

### Snyk Integration

**–ß—Ç–æ –ø—Ä–æ–≤–µ—Ä—è–µ–º**:
- –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (npm, pip)
- Docker –æ–±—Ä–∞–∑—ã
- Infrastructure as Code (docker-compose, terraform)

**–ö–æ–º–∞–Ω–¥—ã**:
```bash
snyk test                      # Dependencies
snyk container test [image]    # Docker images
snyk iac test                  # docker-compose.yml
```

**CI/CD Integration**:
```yaml
# .gitlab-ci.yml
snyk:scan:
  stage: security
  script:
    - snyk test --severity-threshold=high
    - snyk container test quark-user-service:latest
  allow_failure: false  # Hard fail –Ω–∞ high/critical
```

### SAST (Static Application Security Testing)

**–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã**:
- Python: `Bandit`
- JavaScript/TypeScript: `ESLint` + security plugins

**–ü—Ä–∏–º–µ—Ä**:
```bash
bandit -r services/user-service/ -ll  # Only high/medium
eslint --ext .ts --plugin security services/user-service/src/
```

### DAST (Dynamic Application Security Testing)

**–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã**: `OWASP ZAP`

**–°—Ü–µ–Ω–∞—Ä–∏–π**:
```bash
# –ó–∞–ø—É—Å–∫ ZAP –ø—Ä–æ—Ç–∏–≤ running app
docker run -t owasp/zap2docker-stable zap-baseline.py \
  -t http://localhost:3000 \
  -r zap-report.html
```

### JWT Security Checks

**–ß—Ç–æ –ø—Ä–æ–≤–µ—Ä—è–µ–º**:
- ‚ùå JWT –Ω–µ —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ localStorage –±–µ–∑ `httpOnly`
- ‚ùå –°–µ–∫—Ä–µ—Ç—ã –Ω–µ –∑–∞—Ö–∞—Ä–¥–∫–æ–∂–µ–Ω—ã –≤ –∫–æ–¥–µ
- ‚úÖ –†–æ—Ç–∞—Ü–∏—è —Å–µ–∫—Ä–µ—Ç–æ–≤ —á–µ—Ä–µ–∑ Vault
- ‚úÖ Expiration time ‚â§15 –º–∏–Ω—É—Ç

---

## üîÑ CI/CD Pipeline

### Pipeline Stages

```yaml
stages:
  - lint
  - unit
  - contract
  - security
  - integration
  - chaos          # Minimal must-have
  - performance    # Minimal baseline
  - e2e            # –¢–æ–ª—å–∫–æ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ UI/contracts
  - deploy

# –ü—Ä–∏–º–µ—Ä: GitLab CI
lint:
  stage: lint
  script: npm run lint

test:unit:
  stage: unit
  script: npm run test:unit
  coverage: '/Lines\s*:\s*(\d+\.?\d*)%/'
  artifacts:
    reports:
      coverage_report:
        coverage_format: cobertura
        path: coverage/cobertura-coverage.xml

test:contract:
  stage: contract
  script:
    - npm run validate:openapi
    - npm run validate:asyncapi
    - npm run test:contract

snyk:scan:
  stage: security
  script:
    - snyk test --severity-threshold=high
    - snyk container test $CI_REGISTRY_IMAGE:$CI_COMMIT_SHA

test:integration:
  stage: integration
  services:
    - docker:dind
  script: npm run test:integration  # Testcontainers

test:chaos:
  stage: chaos
  script:
    - docker-compose -f docker-compose.chaos.yml up -d toxiproxy
    - npm run test:chaos

test:performance:
  stage: performance
  script:
    - docker-compose -f docker-compose.e2e.yml up -d
    - k6 run tests/performance/baseline.load.js

test:e2e:
  stage: e2e
  rules:
    - changes:
        - contracts/**/*
        - infra/quark-ui/**/*
  script:
    - docker-compose -f docker-compose.e2e.yml up -d
    - npm run test:e2e
  artifacts:
    when: on_failure
    paths:
      - tests/e2e/screenshots/
      - tests/e2e/videos/
```

---

## üìä –ú–µ—Ç—Ä–∏–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞

### –¶–µ–ª–∏ (Definition of Done)

| –ú–µ—Ç—Ä–∏–∫–∞ | –¶–µ–ª—å | –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç |
|---------|------|-----------|
| **Contract tests pass rate** | 100% | spectral, AsyncAPI CLI, Pact |
| **Integration tests pass rate** | 100% | Jest + Testcontainers |
| **Unit coverage (–∫—Ä–∏—Ç–∏—á–Ω–æ–µ)** | ‚â•90% | Jest --coverage |
| **Chaos tests pass rate** | 100% | Toxiproxy + Jest |
| **Performance baseline** | p95 <500ms @10 RPS | k6 |
| **E2E flakiness** | <2% | Playwright |
| **Security vulns (high/critical)** | 0 | Snyk |
| **MTTR (Mean Time To Recover)** | <10 –º–∏–Ω | Grafana + OpenTelemetry |
| **MTTD (Mean Time To Detect)** | <5 –º–∏–Ω | Prometheus alerts |

### Dashboards

**Grafana Dashboard** –¥–ª—è –º–µ—Ç—Ä–∏–∫ —Ç–µ—Å—Ç–æ–≤:
- Test success rate (–ø–æ —É—Ä–æ–≤–Ω—è–º)
- Test execution time (—Ç—Ä–µ–Ω–¥—ã)
- Coverage (–ø–æ —Å–µ—Ä–≤–∏—Å–∞–º)
- Security vulnerabilities (Snyk feed)

---

## ü§ñ –†–æ–ª—å –ò–ò –≤ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏

### 1. AI Test Generator

**–í—Ö–æ–¥**: OpenAPI + AsyncAPI + spec.md (user stories)  
**–í—ã—Ö–æ–¥**: Contract, Integration, Unit, E2E —Ç–µ—Å—Ç—ã

**–ö–æ–º–∞–Ω–¥–∞**:
```bash
./quark-manager.sh spec:generate-tests [###] --type=all
```

**–ß—Ç–æ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è**:
- Contract tests –∏–∑ OpenAPI schemas
- Integration test stubs –∏–∑ AsyncAPI events
- Unit tests –∏–∑ Functional Requirements (spec.md)
- E2E scenarios –∏–∑ user stories

### 2. AI Flakiness Analyzer

**–ü—Ä–æ–±–ª–µ–º–∞**: E2E —Ç–µ—Å—Ç—ã –Ω–µ—Å—Ç–∞–±–∏–ª—å–Ω—ã (flaky).

**–†–µ—à–µ–Ω–∏–µ**: AI –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –ª–æ–≥–∏ –ø—Ä–æ–≤–∞–ª–æ–≤ –∏ –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç —Ñ–∏–∫—Å—ã:
```
‚ùå Test failed: 'element not found: button[type="submit"]'

üí° AI suggestion:
  - Add `await page.waitForSelector('button[type="submit"]')` before click
  - Or use: `await page.click('button:has-text("Submit")')` (semantic selector)
```

### 3. AI Ops Agent

**–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è**: –°–≤—è–∑—ã–≤–∞–µ—Ç –ø—Ä–æ–≤–∞–ª—ã —Ç–µ—Å—Ç–æ–≤ —Å –º–µ—Ç—Ä–∏–∫–∞–º–∏ –∏–∑ Grafana/Sentry.

**–ü—Ä–∏–º–µ—Ä**:
```
‚ùå Integration test failed: NATS connection timeout

ü§ñ AI Ops Agent analysis:
  - Grafana: NATS CPU = 95% (threshold = 80%)
  - Sentry: 15 errors "connection refused" (last 5 min)
  - Suggestion: Increase NATS memory limit in docker-compose.yml
```

### 4. Self-Healing Tests

**Playwright + AI**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∞–¥–∞–ø—Ç–∞—Ü–∏—è —Å–µ–ª–µ–∫—Ç–æ—Ä–æ–≤ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö UI.

**–î–æ**:
```typescript
await page.click('button.submit-form-btn-primary');  // Breaks if CSS class changes
```

**–ü–æ—Å–ª–µ**:
```typescript
await page.click('button:has-text("Submit")');  // Works even if CSS changes
```

---

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è

```
/quark
‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îú‚îÄ‚îÄ auth-service/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ tests/
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ unit/
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ integration/
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ contract/
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ chaos/
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ performance/
‚îÇ   ‚îú‚îÄ‚îÄ blog-service/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ tests/
‚îÇ   ‚îî‚îÄ‚îÄ user-service/
‚îÇ       ‚îî‚îÄ‚îÄ tests/
‚îú‚îÄ‚îÄ infra/
‚îÇ   ‚îî‚îÄ‚îÄ quark-ui/
‚îÇ       ‚îî‚îÄ‚îÄ tests/
‚îÇ           ‚îú‚îÄ‚îÄ unit/
‚îÇ           ‚îî‚îÄ‚îÄ e2e/
‚îú‚îÄ‚îÄ tests/
‚îÇ   ‚îú‚îÄ‚îÄ contract/       # Pact contracts (cross-service)
‚îÇ   ‚îú‚îÄ‚îÄ e2e/            # Full-stack E2E scenarios
‚îÇ   ‚îú‚îÄ‚îÄ performance/    # k6 scripts
‚îÇ   ‚îî‚îÄ‚îÄ chaos/          # Toxiproxy scenarios
‚îú‚îÄ‚îÄ specs/              # Specifications (source of truth)
‚îÇ   ‚îú‚îÄ‚îÄ 001-user-service/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ spec.md
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ plan.md
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ contracts/
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ openapi.yaml
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ asyncapi.yaml
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ module-manifest.yaml
‚îú‚îÄ‚îÄ docs/
‚îÇ   ‚îî‚îÄ‚îÄ testing/
‚îÇ       ‚îú‚îÄ‚îÄ strategy.md          # –≠—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç
‚îÇ       ‚îú‚îÄ‚îÄ ci-cd-pipeline.yml   # –î–µ—Ç–∞–ª—å–Ω—ã–π CI/CD
‚îÇ       ‚îî‚îÄ‚îÄ test-data/           # Golden datasets –¥–ª—è AI
‚îú‚îÄ‚îÄ docker-compose.e2e.yml        # E2E test environment
‚îú‚îÄ‚îÄ docker-compose.chaos.yml      # Chaos test environment (Toxiproxy)
‚îî‚îÄ‚îÄ .gitlab-ci.yml                # CI/CD pipeline
```

---

## üéØ Roadmap –¥–ª—è Quark

### Phase 1: MVP (–¢–µ–∫—É—â–∏–π —ç—Ç–∞–ø)
- ‚úÖ Contract tests (REST + Events)
- ‚úÖ Integration tests —Å Testcontainers
- ‚úÖ Minimal chaos tests (NATS disconnect)
- ‚úÖ Minimal performance baseline (10 RPS)
- ‚úÖ Unit tests –¥–ª—è –∫—Ä–∏—Ç–∏—á–Ω–æ–π –ª–æ–≥–∏–∫–∏
- ‚úÖ E2E –¥–ª—è core scenarios

### Phase 2: Beta (100 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π)
- ‚¨ú Full chaos suite (network partition, cascading failures)
- ‚¨ú Load testing (100 RPS)
- ‚¨ú Soak testing (8 —á–∞—Å–æ–≤)
- ‚¨ú Advanced E2E (–≤—Å–µ user stories)

### Phase 3: Production (1000+ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π)
- ‚¨ú Chaos engineering –≤ production (Chaos Mesh)
- ‚¨ú Stress testing (–¥–æ —Ç–æ—á–∫–∏ –æ—Ç–∫–∞–∑–∞)
- ‚¨ú Shadow traffic testing
- ‚¨ú Canary deployments —Å automated rollback

---

## üí° –ò—Ç–æ–≥–æ–≤—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### –î–ª—è Solo Developer + AI:

**Must-have** (–Ω–µ –æ—Ç–∫–ª–∞–¥—ã–≤–∞—Ç—å):
1. ‚úÖ **Contract tests** ‚Äî –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏–∑ OpenAPI/AsyncAPI
2. ‚úÖ **Integration tests** ‚Äî Testcontainers –¥–ª—è NATS + PostgreSQL
3. ‚úÖ **Minimal chaos** ‚Äî NATS disconnect (30 –º–∏–Ω—É—Ç)
4. ‚úÖ **Minimal perf** ‚Äî 10 RPS baseline (10 –º–∏–Ω—É—Ç)
5. ‚úÖ **Security** ‚Äî Snyk –≤ CI (5 –º–∏–Ω—É—Ç setup)

**Should-have** (–ø–æ—Å–ª–µ MVP):
6. ‚ö†Ô∏è **Unit tests** ‚Äî AI –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –∏–∑ spec.md
7. ‚ö†Ô∏è **E2E** ‚Äî Playwright –¥–ª—è –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤

**Nice-to-have** (–ø–æ—Å–ª–µ –ø–µ—Ä–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π):
8. üîµ **Full chaos suite**
9. üîµ **Load testing** (100+ RPS)

---

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã

- [OpenAPI Specification](https://swagger.io/specification/)
- [AsyncAPI Specification](https://www.asyncapi.com/docs/reference)
- [Testcontainers Documentation](https://testcontainers.com/)
- [Pact Documentation](https://docs.pact.io/)
- [k6 Documentation](https://k6.io/docs/)
- [Playwright Documentation](https://playwright.dev/)
- [Toxiproxy GitHub](https://github.com/Shopify/toxiproxy)
- [Chaos Mesh Documentation](https://chaos-mesh.org/docs/)

---

**–£—Ç–≤–µ—Ä–∂–¥–µ–Ω–æ –ì–ª–∞–≤–Ω—ã–º –ê—Ä—Ö–∏—Ç–µ–∫—Ç–æ—Ä–æ–º: 2025-11-03**
