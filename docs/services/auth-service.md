# Auth Service - –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

## üìã –û–±–∑–æ—Ä

Auth Service - —ç—Ç–æ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏, –ø–æ—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –Ω–∞ –±–∞–∑–µ NestJS –∏ TypeScript. –°–µ—Ä–≤–∏—Å –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç JWT –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é, —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ –∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é —Å Plugin Hub —á–µ—Ä–µ–∑ Universal Docking Interface.

## ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å

### üîê –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
- **JWT —Ç–æ–∫–µ–Ω—ã** - –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è access —Ç–æ–∫–µ–Ω–æ–≤
- **–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π** - POST `/auth/register`
- **–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è** - POST `/auth/login`
- **–ü—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è** - GET `/auth/profile` (–∑–∞—â–∏—â–µ–Ω–Ω—ã–π endpoint)

### üóÑÔ∏è –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
- **PostgreSQL –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è** —á–µ—Ä–µ–∑ TypeORM
- **–ú–æ–¥–µ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è** —Å –ø–æ–ª—è–º–∏: id, email, password, firstName, lastName, createdAt, updatedAt
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –º–∏–≥—Ä–∞—Ü–∏–∏** –∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å—Ö–µ–º—ã

### üîå Plugin Hub –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è** –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ —Å–µ—Ä–≤–∏—Å–∞
- **–ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏–π heartbeat** –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥
- **Service Discovery** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ —á–µ—Ä–µ–∑ Universal Docking Interface
- **Health checks** - endpoint `/auth/health` –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

### üê≥ –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏—è
- **–ú—É–ª—å—Ç–∏—Å—Ç–∞–¥–∏–π–Ω–∞—è —Å–±–æ—Ä–∫–∞** –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ —Ä–∞–∑–º–µ—Ä–∞ –æ–±—Ä–∞–∑–∞
- **Node.js 20 Alpine** –±–∞–∑–æ–≤—ã–π –æ–±—Ä–∞–∑
- **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å** - non-root –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å, –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –ø—Ä–∏–≤–∏–ª–µ–≥–∏–∏
- **Health check** –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –≤ Docker

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞
```
services/auth-service/
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ main.ts                 # Bootstrap –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è + Plugin Hub —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ app.module.ts          # –û—Å–Ω–æ–≤–Ω–æ–π –º–æ–¥—É–ª—å —Å –∏–º–ø–æ—Ä—Ç–∞–º–∏
‚îÇ   ‚îú‚îÄ‚îÄ auth/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ auth.controller.ts  # REST endpoints –¥–ª—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ auth.service.ts     # –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ auth.module.ts      # –ú–æ–¥—É–ª—å –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ jwt.strategy.ts     # Passport JWT —Å—Ç—Ä–∞—Ç–µ–≥–∏—è
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ jwt-auth.guard.ts   # Guard –¥–ª—è –∑–∞—â–∏—â–µ–Ω–Ω—ã—Ö endpoints
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ dto/               # Data Transfer Objects
‚îÇ   ‚îî‚îÄ‚îÄ users/
‚îÇ       ‚îú‚îÄ‚îÄ user.entity.ts      # TypeORM entity –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
‚îÇ       ‚îú‚îÄ‚îÄ users.service.ts    # –°–µ—Ä–≤–∏—Å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏
‚îÇ       ‚îî‚îÄ‚îÄ users.module.ts     # –ú–æ–¥—É–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
‚îú‚îÄ‚îÄ Dockerfile                 # –ú—É–ª—å—Ç–∏—Å—Ç–∞–¥–∏–π–Ω–∞—è —Å–±–æ—Ä–∫–∞
‚îú‚îÄ‚îÄ package.json               # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ NestJS + TypeORM + JWT
‚îî‚îÄ‚îÄ tsconfig.json              # TypeScript –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
```

### –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫
- **NestJS 10** - —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π Node.js —Ñ—Ä–µ–π–º–≤–æ—Ä–∫
- **TypeScript** - —Ç–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞
- **TypeORM** - ORM –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å PostgreSQL
- **Passport.js + JWT** - –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
- **bcryptjs** - —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞—Ä–æ–ª–µ–π
- **class-validator** - –≤–∞–ª–∏–¥–∞—Ü–∏—è DTO

## üîó Plugin Hub –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è

### –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —Å–µ—Ä–≤–∏—Å–∞
```typescript
async function registerWithPluginHub(port: number) {
  const serviceData = {
    id: 'auth-service',
    name: 'Auth Service',
    type: 'authentication',
    version: '1.0.0',
    url: serviceUrl,
    healthEndpoint: `${serviceUrl}/auth/health`,
    metadata: {
      description: 'JWT Authentication and User Management Service',
      tags: ['auth', 'jwt', 'users', 'security'],
      endpoints: ['/auth/login', '/auth/register', '/auth/profile', '/users'],
      dependencies: ['postgresql', 'plugin-hub']
    }
  };

  // –ü–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–∞—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
  await fetch(`${pluginHubUrl}/api/services/register`, {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify(serviceData)
  });

  // –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏–π heartbeat –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥
  setInterval(sendHeartbeat, 30000);
}
```

### Heartbeat –º–µ—Ö–∞–Ω–∏–∑–º
- **–ß–∞—Å—Ç–æ—Ç–∞**: –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥
- **Endpoint**: `POST /api/services/register` (–ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è)
- **–¶–µ–ª—å**: –ø–æ–¥–¥–µ—Ä–∂–∞–Ω–∏–µ –∞–∫—Ç—É–∞–ª—å–Ω–æ–≥–æ —Å—Ç–∞—Ç—É—Å–∞ –≤ Service Registry
- **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥**: –ª–æ–≥–∏ `üíó Heartbeat sent to Plugin Hub`

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### Health Check endpoint
```typescript
@Get('health')
async health() {
  return {
    status: 'ok',
    timestamp: new Date().toISOString(),
    service: 'auth-service',
    version: '1.0.0'
  };
}
```

### –°—Ç–∞—Ç—É—Å—ã –≤ Monitoring Dashboard
- **üü¢ –ó–µ–ª–µ–Ω—ã–π (–û–Ω–ª–∞–π–Ω)**: heartbeat < 30 —Å–µ–∫—É–Ω–¥ –Ω–∞–∑–∞–¥
- **üü° –ñ–µ–ª—Ç—ã–π (–ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ)**: heartbeat 30-120 —Å–µ–∫—É–Ω–¥ –Ω–∞–∑–∞–¥  
- **üî¥ –ö—Ä–∞—Å–Ω—ã–π (–û—Ñ–ª–∞–π–Ω)**: heartbeat > 120 —Å–µ–∫—É–Ω–¥ –Ω–∞–∑–∞–¥

## üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### JWT –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
- **–ê–ª–≥–æ—Ä–∏—Ç–º**: HS256
- **Secret**: –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –æ–∫—Ä—É–∂–µ–Ω–∏—è `JWT_SECRET`
- **–í—Ä–µ–º—è –∂–∏–∑–Ω–∏**: –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ `JWT_EXPIRES_IN`

### –ó–∞—â–∏—Ç–∞ –ø–∞—Ä–æ–ª–µ–π
- **–•–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ**: bcryptjs —Å —Å–æ–ª—å—é
- **–í–∞–ª–∏–¥–∞—Ü–∏—è**: –º–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏–Ω–∞, —Å–ª–æ–∂–Ω–æ—Å—Ç—å (–Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è)

### Docker –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
- **Non-root –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å**: `quark` (uid: 1001)
- **–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –ø—Ä–∏–≤–∏–ª–µ–≥–∏–∏**: —Ç–æ–ª—å–∫–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø—Ä–∞–≤–∞
- **Alpine –±–∞–∑–æ–≤—ã–π –æ–±—Ä–∞–∑**: —É–º–µ–Ω—å—à–µ–Ω–Ω–∞—è –ø–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç—å –∞—Ç–∞–∫

## üöÄ –î–µ–ø–ª–æ–π

### Docker Compose
```yaml
auth-service:
  build: 
    context: ./services/auth-service
    dockerfile: Dockerfile
  container_name: quark-auth
  ports:
    - "3001:3001"
  environment:
    - NODE_ENV=production
    - DB_HOST=postgres
    - DB_PORT=5432
    - DB_NAME=quark_auth
    - DB_USER=quark_user
    - DB_PASS=quark_password
    - JWT_SECRET=your-secret-key
    - PLUGIN_HUB_URL=http://plugin-hub:3000
    - SERVICE_URL=http://auth-service:3001
  depends_on:
    - postgres
    - plugin-hub
  healthcheck:
    test: ["CMD", "node", "-e", "const http = require('http'); http.get('http://localhost:3001/auth/health', (res) => { process.exit(res.statusCode === 200 ? 0 : 1); }).on('error', () => process.exit(1));"]
    interval: 30s
    timeout: 3s
    start_period: 5s
    retries: 3
```

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
- `NODE_ENV` - environment (development/production)
- `DB_HOST`, `DB_PORT`, `DB_NAME`, `DB_USER`, `DB_PASS` - –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ PostgreSQL
- `JWT_SECRET` - —Å–µ–∫—Ä–µ—Ç –¥–ª—è –ø–æ–¥–ø–∏—Å–∏ JWT —Ç–æ–∫–µ–Ω–æ–≤
- `JWT_EXPIRES_IN` - –≤—Ä–µ–º—è –∂–∏–∑–Ω–∏ —Ç–æ–∫–µ–Ω–æ–≤ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 1h)
- `PLUGIN_HUB_URL` - URL Plugin Hub –¥–ª—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
- `SERVICE_URL` - –≤–Ω–µ—à–Ω–∏–π URL —Å–µ—Ä–≤–∏—Å–∞ –¥–ª—è Service Registry

## üìà –ú–µ—Ç—Ä–∏–∫–∏ –∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

### Startup –≤—Ä–µ–º—è
- **–•–æ–ª–æ–¥–Ω—ã–π —Å—Ç–∞—Ä—Ç**: ~3-5 —Å–µ–∫—É–Ω–¥
- **–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ë–î**: ~1-2 —Å–µ–∫—É–Ω–¥—ã
- **Plugin Hub —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è**: ~500ms

### –†–µ—Å—É—Ä—Å—ã
- **–ü–∞–º—è—Ç—å**: ~50MB RAM (production)
- **CPU**: minimal –ø—Ä–∏ idle, –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ—Ç—Å—è –ø–æ–¥ –Ω–∞–≥—Ä—É–∑–∫–æ–π
- **–û–±—Ä–∞–∑ Docker**: ~150MB (–æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π)

## üîÑ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

### –ü–ª–∞–Ω–∏—Ä—É–µ–º—ã–µ —É–ª—É—á—à–µ–Ω–∏—è
1. **Refresh —Ç–æ–∫–µ–Ω—ã** - –¥–æ–ª–≥–æ–≤—Ä–µ–º–µ–Ω–Ω–∞—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
2. **OAuth2 –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è** - Google, GitHub, –ì–æ—Å—É—Å–ª—É–≥–∏
3. **RBAC —Å–∏—Å—Ç–µ–º–∞** - —Ä–æ–ª–∏ –∏ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞
4. **Rate limiting** - –∑–∞—â–∏—Ç–∞ –æ—Ç –±—Ä—É—Ç—Ñ–æ—Ä—Å –∞—Ç–∞–∫
5. **2FA –ø–æ–¥–¥–µ—Ä–∂–∫–∞** - –¥–≤—É—Ö—Ñ–∞–∫—Ç–æ—Ä–Ω–∞—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è

### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —ç–∫–æ—Å–∏—Å—Ç–µ–º–æ–π
- **Blog Service** - –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –ø–æ—Å—Ç–æ–≤
- **User Service** - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è–º–∏
- **Messaging Service** - –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –≤ —á–∞—Ç–∞—Ö
- **AI Orchestrator** - –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ò–ò-–∞–≥–µ–Ω—Ç—ã

## üéØ –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

Auth Service —É—Å–ø–µ—à–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω –∫–∞–∫ –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–π –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å —Å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π –≤ –ú–ö–° –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É. –°–µ—Ä–≤–∏—Å –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç:

- ‚úÖ –ù–∞–¥–µ–∂–Ω—É—é JWT –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫—É—é –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é —Å Plugin Hub
- ‚úÖ –ö–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ –∫–æ–¥–∞ –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
- ‚úÖ Production-ready –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏—é
- ‚úÖ –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ observability

–ì–æ—Ç–æ–≤ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é –¥—Ä—É–≥–∏–º–∏ —Å–µ—Ä–≤–∏—Å–∞–º–∏ —ç–∫–æ—Å–∏—Å—Ç–µ–º—ã –∏ –¥–∞–ª—å–Ω–µ–π—à–µ–º—É —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏.
